class PgActiveClassesForPgel_Abstract{constructor(){this.level_offset=1}getTreeChildren(){return null}populateTreeFata(e){}populateDataItem(e){}getCellWidth(){return 0}getPgelObj(){}refreshTree(){this.getClassTreeView().refresh()}getClassTreeView(){return this.getPgelObj().tree_view}}class PgActiveClassesForPgel extends PgActiveClassesForPgel_Abstract{constructor(e,t){super();var s=this,a=(this.pgel=e,this.tree_view=t,this.device_sizes_and_states={},e.getPage().activeView.getDeviceSizes(this.device_sizes_and_states),this.inline=new PgActiveClassesForPgel_ClassStyle(null,this),this.styles=[this.inline],this.styles_map={},{done:!1,show_class_styles:!1,sizes:!0,list:[]});pinegrow.dispatchEvent("on_get_active_classes_for_pgel",e.getPage(),e,a),this.show_class_styles=a.show_class_styles,this.inline.show_in_tree=this.show_class_styles,a.list.forEach(function(e){var t=e.classStyle?s.getStyleContainer(e.classStyle):s.inline;t.addClass(e.state||"all",e.class,e)}),this.parent=e.parent&&e.parent.isElement?new PgActiveClassesForPgel(e.parent,t):null}getAvailableStates(){return this.device_sizes_and_states.states}getStyleContainer(e){var t;return this.styles_map[e.key]||(t=new PgActiveClassesForPgel_ClassStyle(e,this),this.styles_map[e.key]=t,this.styles.push(t),t)}toString(){var t=`Active classes for ${this.pgel.tagName}:`;return this.styles.forEach(function(e){t+="\n    "+e.toString()}),this.parent&&(t+="\n"+this.parent.toString()),t}populateTreeFata(e){e.node=this,e.template_type="pgel"}getTreeChildren(){return this.show_class_styles?this.styles:this.inline.getTreeChildren()}getParents(){for(var e=[],t=this.parent;t;)e.push(t),t=t.parent;return e}}class PgActiveClassesForPgel_ClassStyle extends PgActiveClassesForPgel_Abstract{constructor(e,t){super(),this.sizes=[],this.sizes_map={},this.classStyle=e,this.parent_pgel_obj=t,this.show_in_tree=!0,this.states=[],this.states_map={},this.add_state=new PgActiveClassesForPgel_AddState(this),this.add_class=new PgActiveClassesForPgel_AddClass(this),this.addState("all")}addClass(e,t,s){this.getState(e).addClass(t,s)}addState(e){var t=new PgActiveClassesForPgel_State(e,this);return this.states.push(t),this.states_map[e]=t}getState(e){return this.states_map[e]||this.addState(e)}toString(){var t=``+(this.classStyle?this.classStyle.key:"(inline)");return this.states.forEach(function(e){t+="\n            "+e.toString()}),t}populateTreeFata(e){e.node=this,e.template_type="classstyle",this.classStyle&&(e.search_string+=this.classStyle.key)}getTreeChildren(){var t=[];return this.states.forEach(function(e){"all"===e.state?t=t.concat(e.getTreeChildren()):t.push(e)}),t.push(this.add_state),t}getClassWithSizeAndState(e){return e}getPgelObj(){return this.parent_pgel_obj}getPgel(){return this.parent_pgel_obj.pgel}getStyle(){return this.classStyle}getClassPrefix(){return this.getClassWithSizeAndState("")}}class PgActiveClassesForPgel_Size extends PgActiveClassesForPgel_Abstract{constructor(e,t){super(),this.size=e,this.states=[],this.states_map={},this.parent_class_style=t,this.add_state=new PgActiveClassesForPgel_AddState(this),this.add_class=new PgActiveClassesForPgel_AddClass(this)}toString(){return``+this.size}populateTreeFata(e){e.node=this,e.template_type="size"}getTreeChildren(){return this.states.concat([this.add_class,this.add_state])}getClassWithSizeAndState(e){return"all"!==this.size?this.size+":"+e:e}getPgel(){return this.parent_class_style.parent_pgel_obj.pgel}getStyle(){return this.parent_class_style.classStyle}getClassPrefix(){return this.getClassWithSizeAndState("")}}class PgActiveClassesForPgel_State extends PgActiveClassesForPgel_Abstract{constructor(e,t){super(),this.state=e,this.classes=[],this.classes_map={},this.parent_class_style=t,this.add_class=new PgActiveClassesForPgel_AddClass(this),this.level_offset=1}addClass(e,t,s){const a=this;t||(i={},pinegrow.dispatchEvent("on_get_class_info",this.getPgel().getPage(),e,i),t=i.info||{}),t&&t.values&&Array.isArray(t.values[0])&&(n=[],t.values.forEach(function(e){n=n.concat(e)}),t.values=n);var n,i=new PgActiveClassesForPgel_Class(e,t,this);s&&t.values&&t.values.forEach(function(e){var t;a.classes_map[e.key]&&(0<=(t=a.classes.indexOf(a.classes_map[e.key]))&&a.classes.splice(t,1),delete a.classes_map[e.key])}),this.classes.push(i),this.classes_map[t.class]=i}toString(){var t=``+this.state;return this.classes.forEach(function(e){t+="\n            - "+e.toString()}),t}changeState(e){var t,s,a;(e=e||"all")!==this.state&&((t=this).getClassWithSizeAndState(),s=[],this.classes.forEach(function(e){s.push(t.getClassWithSizeAndState(e.class))}),this.state=e,a=[],this.classes.forEach(function(e){a.push(t.getClassWithSizeAndState(e.class))}),(new PgApi).addClass(this.getPgel(),a,{},s))}populateTreeFata(e){e.node=this,e.template_type="state"}getTreeChildren(){return this.classes.concat([this.add_class])}getClassWithSizeAndState(e){return"all"!==this.state?this.state+":"+e:e}getPgel(){return this.parent_class_style.parent_pgel_obj.pgel}getStyle(){return this.parent_class_style.classStyle}getClassPrefix(){return this.getClassWithSizeAndState("")}}class PgActiveClassesForPgel_Class extends PgActiveClassesForPgel_Abstract{constructor(e,t,s){super(),this.class=e,this.info=t,this.parent_state=s}toString(){return this.class}populateTreeFata(e){e.node=this,e.template_type="class",e.search_string+=this.class}getTreeChildren(){return null}getCellWidth(){return pgMeasureTextWidth(this.class)+30}getPgelObj(){return this.parent_state.parent_class_style.parent_pgel_obj}getPgel(){return this.getPgelObj().pgel}getClassWithSizeAndState(e){return void 0===e&&(e=this.class),this.parent_state.getClassWithSizeAndState(e)}getClassPrefix(){return this.getClassWithSizeAndState("")}getState(){return this.parent_state}getClassStyle(){return this.parent_state.parent_class_style}changeClassTo(e,t){var s=this.getPgel(),a=this.getClassWithSizeAndState(this.class),n=this.getClassWithSizeAndState(e),i=this.getClassStyle(),l={source:this.getClassTreeView()};if(i.classStyle){if(i.classStyle.locked)return pinegrow.showQuickError("The style is locked."),void(t&&t(!1));pinegrow.makeChanges(s,"Set "+e,function(){pinegrow.classStyles.addClassToStyle(s,i.classStyle,n,a)},l),pinegrow.dispatchEventDelayed("on_element_classes_changed",null,pinegrow.getCollectionForElement(s),l)}else pinegrow.classStyles.getStylesForPgel(s).length?(pinegrow.makeChanges(s,"Set "+e,function(){pinegrow.classStyles.addClassToStyle(s,null,n,a)},l),pinegrow.dispatchEventDelayed("on_element_classes_changed",null,pinegrow.getCollectionForElement(s),l)):(new PgApi).addClass(pinegrow.getCollectionForElement(s),[n],l,[a]);this.class=e,t&&t(!0)}removeClass(e){var t=this,s=this.getPgel(),a=this.getClassWithSizeAndState(this.class),n=this.getClassStyle();if(n.classStyle){if(n.classStyle.locked)return pinegrow.showQuickError("The style is locked."),void(e&&e(!1));pinegrow.makeChanges(s,"Remove "+a,function(){pinegrow.classStyles.removeClassFromStyle(s,n.classStyle,a)},{source:t.getClassTreeView()})}else pinegrow.classStyles.getStylesForPgel(s).length?pinegrow.makeChanges(s,"Remove "+a,function(){pinegrow.classStyles.removeClassFromStyle(s,null,a)},{source:t.getClassTreeView()}):(new PgApi).removeClass(pinegrow.getCollectionForElement(s),[a],{source:t.getClassTreeView()});e&&e(!0)}}class PgActiveClassesForPgel_AddClass extends PgActiveClassesForPgel_Abstract{constructor(e){super(),this.parent=e}populateTreeFata(e){e.node=this,e.template_type="add_class"}getTreeChildren(){return null}getCellWidth(){return pgMeasureTextWidth("Add class")+30}getPgel(){return this.parent.getPgel()}getStyle(){return this.parent.getStyle()}addClass(e){this.parent.addClass(e,null,!0)}}class PgActiveClassesForPgel_AddState extends PgActiveClassesForPgel_Abstract{constructor(e){super(),this.parent=e,this.level_offset=1}populateTreeFata(e){e.node=this,e.template_type="add_state"}getTreeChildren(){return null}getCellWidth(){return 0}getPgelObj(){return this.parent.parent_pgel_obj}getAvailableStates(){return this.getPgelObj().getAvailableStates()}addState(e){this.parent.addState(e),this.refreshTree()}}var PgQuickClassTree=function(){var e=new PgClassTreeView,t=new PgQuickWindow("Class tree",e,"quickClassTree",400,700);t.noRightEdge(),t.showAtPosition(800,0),e.show(),t.onDestroy=function(){}};class PgClassTreeCellPgel extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-pgel"><!--<i data-element="icon" class="icon-KODA"></i>--><name data-element="name"></name>
</div>`,e,t),this.tooltip("cell","Click to select the element."),this.on("cell","click",this.onClick.bind(this)),this.on("cell","mouseenter",this.onMouseEnter.bind(this)),this.on("cell","mouseleave",this.onMouseLeave.bind(this))}onPopulate(){var e=this.data.node.pgel,e=(this.setHtml("name",e.getName({short:!1,num_classes:-1})),pinegrow.selectedElements.isSelectedElement(e));e?this.addClass("cell","selected"):this.removeClass("cell","selected")}onClick(e){e.preventDefault(),e.stopPropagation(),pinegrow.selectElement(this.data.node.pgel,null,null,null,e,{source:this.classTreeView})}onMouseEnter(e){pinegrow.highlightElement(this.data.node.pgel.get$DOMElement())}onMouseLeave(e){pinegrow.highlightElement(null)}}class PgClassTreeCellClassStyle extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-classstyle"><name data-element="name"></name>
</div>`,e,t),this.on("cell","click",this.onClick.bind(this))}onPopulate(){this.setHtml("name",this.data.node.classStyle?this.data.node.classStyle.key:"(inline)")}onClick(e){e.preventDefault(),e.stopPropagation()}}class PgClassTreeCellSize extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-size"><i data-element="icon" class="collapse-icon icon-down"></i><name data-element="name"></name>
</div>`,e,t),this.on("cell","click",this.onClick.bind(this))}onPopulate(){this.setHtml("name",this.data.node.size)}onClick(e){e.preventDefault(),e.stopPropagation()}}class PgClassTreeCellState extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-state"><!--<i data-element="icon" class="collapse-icon icon-down"></i>--><name data-element="name"></name>
</div>`,e,t),this.on("cell","click",this.onClick.bind(this))}onPopulate(){this.setHtml("name",this.data.node.state)}onClick(e){const t=this;var s=new PgClassStateComposerDropdown;return s.onChanged=function(){t.data.node.changeState(s.getValue()),t.classTreeView.show()},s.setValue(this.data.node.state),s.show(e),e.preventDefault(),e.stopPropagation(),!1}}class PgClassTreeCellClass extends PgTableGridCell{constructor(e,t){super(),this.init(`<div data-element="cell" class="pg-class-tree-class"><input data-element="check" type="checkbox" checked><name data-element="name"></name>
</div>`,e,t),this.on("name","click",this.onClick.bind(this)),this.on("check","change",this.onCheck.bind(this)),this.on("check","click",this.onStopEvent.bind(this))}onPopulate(){this.setHtml("name",this.data.node.class),this.getElement("check").checked=!0!==this.data.node.disabled,this.data.node.disabled?this.addClass("cell","unchecked"):this.removeClass("cell","unchecked")}onCheck(e){e.preventDefault(),e.stopPropagation();var t=this.getElement("check").checked;const s=this;t?s.data.node.changeClassTo(s.data.node.class,function(){s.data.node.disabled=!1,s.onPopulate()}):s.data.node.removeClass(function(){s.data.node.disabled=!0,s.onPopulate()})}onStopEvent(e){e.stopPropagation()}onClick(e){e.preventDefault(),e.stopPropagation();function t(){r.destroy(),o.data.node.changeClassTo(this.class,function(){o.onPopulate()})}var s,a,n,i,l,o=this,r=new PgFastDOMClassPreviewForPgel(this.data.node.getPgel(),this.data.node.getClassPrefix());this.data.node.info.values&&Array.isArray(this.data.node.info.values[0])?(s=[],this.data.node.info.values.forEach(function(e){s=s.concat(e)}),l=(a=$(`<div style="position:absolute;top:-1000px;left:0px;display:none;"><input type="hidden" value="${this.data.node.class}"/></div>`).appendTo($("body"))).find("input"),n=new PgColorPicker(l,this.data.node.info.values,"",function(){return{}},{on_color_highlighted:function(e){e?r.setClass(e,s):r.restore()},on_show:function(){},on_value_set:function(e){t.call({class:e})},on_hide:function(){r.destroy(),a.remove()}}),l.on("change",function(e){}),pgCloseContextMenus(),n.close_on_mouseleave=!1,n.showWithPosition($(e.target)),n.keepOpenOnClick=!1,setTimeout(function(){n.close_on_mouseleave=!0},300)):(i=[],this.data.node.info.values&&this.data.node.info.values.forEach(function(e){i.push({label:e.name,class:e.key,action:t,check:e.key===o.data.node.class,on_mouseenter:function(){r.setClass(e.key,o.data.node.info.values)},on_mouseleave:function(){r.restore()}})}),i.push({type:"divider"}),i.push({label:'<i class="icon icon-close" style="color:white;margin-right:8px;"></i> Clear',action:function(){r.destroy(),o.data.node.removeClass(function(){o.classTreeView.show()})},on_mouseenter:function(){r.setClass(null,o.data.node.info.values)},on_mouseleave:function(){r.restore()}}),l=$(e.target),(l=new CrsaContextMenu(i,l)).pos_checked_at_mouse=!0,l.showAt(e.pageX,e.pageY,$(e.target).closest(".pg-tree-container")),l.onClosed=function(){r.destroy()})}}class PgTreeCellButton{constructor(e){this.cell=e}getHTML(){}addHandlers(){}}class PgClassTreeAddClassButton extends PgTreeCellButton{constructor(e){super(e)}getHTML(){return`<span data-element="add-button">
<i class="icon icon-plus"></i> Add class</span>`}addHandlers(){this.cell.on("add-button","click",this.onClick.bind(this))}onClick(e){var t=this,s=(e.preventDefault(),e.stopPropagation(),new PgAddClassContextMenu(this.cell.data.node.getPgel(),this.cell.data.node.getStyle(),this.cell.data.node.parent.getClassPrefix()));s.source=this.classTreeView,s.onClassSet=function(e){t.cell.data.node.addClass(e),t.cell.classTreeView.refresh()},s.showForEvent(e)}}class PgClassTreeCellAddClass extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-add-class" ><span data-element="add">
<i class="icon icon-plus"></i> Add class</span>
</div>`,e,t),this.tooltip("cell","Click to add a class."),this.on("cell","click",this.onClick.bind(this))}onClick(e){var t=this,s=(e.preventDefault(),e.stopPropagation(),new PgAddClassContextMenu(this.data.node.getPgel(),this.data.node.getStyle(),this.data.node.parent.getClassPrefix()));s.source=this.classTreeView,s.onClassSet=function(e){t.data.node.addClass(e),t.classTreeView.refresh()},s.showForEvent(e)}}class PgClassTreeCellAddState extends PgTableGridCell{constructor(e,t){super(`<div data-element="cell" class="pg-class-tree-add-state" ><span data-element="add">
<i class="icon icon-plus"></i></span>
</div>`,e,t),this.tooltip("add","Click to add a variant."),this.on("cell","click",this.onClick.bind(this))}onClick(e){var t=this,s=(e.preventDefault(),e.stopPropagation(),new PgClassStateComposerDropdown);s.onChanged=function(){t.data.node.addState(s.getValue())},s.setValue(""),s.show(e)}}var PgClassTreeView=function(){pinegrow.registerTreeView(this);function d(e){var t=e.closest("div");return C.visibleData[parseInt(t.attr("data-visible-idx"))]}var u,f,v,t=$("<div/>",{id:"pg-tree",class:"pg-tree pg-css-tree pg-class-tree"}),e=(new PgApi,new PgSearchBox({toolbar_on:!0,placeholder_active:null,placeholder:"Filter by class name"})),s=this.toolbar=e.getToolbar(),a=(s.addSection("settings").$element,new PgButtonToolbarItem("icon-tools","Switch to the visual editing mode.")),n=(s.addItem("settings",a),{position:{label:"Position",desc:"Show only the elements with inline styles",re:/_(top|right|bottom|left|position|z\-index)_/i},text:{label:"Text",desc:"Show only images",re:/font|line-height|_color_|letter-spacing|text-decoration|text-align|text-transform|white-space|word-break|_direction_|text-indent/i}}),i={},l=($.each(n,function(e,t){i[e]=!1}),i),o=(a.onClick=function(){var e=[];pinegrow.getSelectedPage()&&pinegrow.getSelectedPage().callFrameworkHandler("on_device_size_selector_settings",e),new CrsaContextMenu(e,this.$element).showForElement(this.$element,null,8)},this.setFilterOption=function(e,t){var s;l=$.extend({},i),e?(s=n[e],l[e]=!0,a.setActive(!0),pinegrow.showMode(s.desc,!0),c(s.label)):(a.setActive(!1),c()),b.setFilterOptions(l),t||b.research(!0)},e.$element.appendTo(t),e.$element.find(".pg-button-toolbar-section.icons")),r=(new PgSearchBoxSpacer,e.onSearch=function(e){var t=new CrsaProfile;b&&b.search(e),e.length?pg$Show(o,"inline-block"):pg$Hide(o),t.show("SEARCH")},pg$Hide(o),$('<div class="pg-tree-filter-msg"><div>Show only: <span></span><i class="close icon icon-close"></i></div></div>').appendTo(t)),c=(pg$Hide(r),r.on("click",function(e){e.preventDefault(),g.setFilterOption(null)}),function(e){e?(r.find("span").html(e),pg$Show(r,"flex"),t.addClass("with-filter-msg")):(pg$Hide(r),t.removeClass("with-filter-msg"))}),s=$("<div/>",{class:"pg-tree-container"}).appendTo(t),h=this.view=new PgUIView(t,"tree","Class Tree"),g=(h.getId(),h.classForContainer="pg-tree-panel-container",this),m=(h.tabIcon="icon-Pin11",h.onShow=function(){},new PgTreeNodeMenu([{icon:"icon-bin",name:"Delete",func:function(e){}},{icon:"icon-duplicate",name:"Duplicate",func:function(e){}},{icon:"icon-hide",name:"Hide / show in Pinegrow",key:"hide",func:function(e,t){}},{icon:'<i class="icon icon-Ins_before"><span class="path1"></span><span class="path2"></span></i>',name:"Insert before",func:function(e){}},{icon:'<i class="icon icon-Ins_after"><span class="path1"></span><span class="path2"></span></i>',name:"Insert after",func:function(e){}},{icon:'<i class="icon icon-Append"><span class="path1"></span><span class="path2"></span></i>',name:"Insert into at beginning (prepend)",func:function(e){}},{icon:'<i class="icon icon-Prepend"><span class="path1"></span><span class="path2"></span></i>',name:"Insert into at end (append)",func:function(e){}}])),C=(m.hide(),new PgTableGrid({highlightLevels:!1})),p=(C.variableHeight=!0,C.getCellWidthForData=function(e){return 0},C.getCellHeightForData=function(e){return C.cellHeight},null),_=(C.onScroll=function(){p&&p.updatePosition(),z()},s.append(C.$element),m.$element.appendTo(t),C.setTemplate(PgClassTreeCellPgel,"pgel"),C.setTemplate(PgClassTreeCellClassStyle,"classstyle"),C.setTemplate(PgClassTreeCellSize,"size"),C.setTemplate(PgClassTreeCellState,"state"),C.setTemplate(PgClassTreeCellClass,"class"),C.setTemplate(PgClassTreeCellAddClass,"add_class"),C.setTemplate(PgClassTreeCellAddState,"add_state"),C.onSetDataToCell=function(e,t){this.data&&(this.data.cell=null),(e.cell=t).classTreeView=g,b.populateDataItem(e);e.node;C.hasChildren(e)?e.collapsed?(t.addClass("icon","icon-right"),t.removeClass("icon","icon-minus","icon-down"),t.$element.addClass("collapsed")):(t.removeClass("icon","icon-minus","icon-right"),t.addClass("icon","icon-down"),t.$element.removeClass("collapsed")):(t.removeClass("icon","icon-down","icon-right"),t.addClass("icon","icon-minus"),t.$element.removeClass("collapsed"));var s=e.search||0;t.$element.removeClass("search-1 search-2 search-0").addClass("search-"+s),t.onPopulate()},C.onRepaint=function(){m.setBottom(C.getHScrollBarSize()),m.setRight(C.getVScrollBarSize()),z()},this.scrollToNode=function(e){var t=M(e);t&&C.scrollTo(t)},this.updateLayout=function(){var e;nextFrame.do("refreshGrid",function(){C&&(C.refresh(),h.isVisible()?e&&e():h.whenVisible(function(){C.show(),e&&e()}))})},function(e){var t=$(e.currentTarget).closest("div");return C.visibleData[parseInt(t.attr("data-visible-idx"))]}),M=function(e){for(var t=C.data,s=0;s<t.length;s++)if(t[s].node===e)return t[s];return null},w=(this.isOverTree=function(e,t){return(!t||"css"===t.dragType)&&h.getWindow()===e.view&&h.isVisible()&&e.pageX>=f.left&&e.pageX<=f.right-(m.isHidden()?0:m.width+C.getVScrollBarSize())&&e.pageY>=f.top&&e.pageY<=f.bottom?{left:e.pageX-f.left,top:e.pageY-f.top}:null},this.getDropPositionInfo=function(e,t,s){var a=C.dragOver(s);return C.showInsertionPoint(a),a},C.$container.on("mouseover",".pg-table-grid-cell",function(e){C.inScroll||(_(e),pinegrow.getDragMenu()),e.stopImmediatePropagation()}).on("mouseout",".pg-table-grid-cell",function(e){C.inScroll||pinegrow.getDragMenu(),e.stopImmediatePropagation()}).on("click","i.collapse-icon",function(e){var t=_(e);t.collapsed=!(t.collapsed||0),e.altKey&&C.forEachVisibleSibling(t,function(e){e.collapsed=t.collapsed}),C.refresh(),e.preventDefault(),e.stopPropagation()}).on("click",function(e){if(O){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var s=O.data.node,a=("add_prop"===s.type&&(s=s.target_node),pgcssh.getRuleForNode(s)),t=$(e.currentTarget);const n=new PgCSSApi;new CrsaContextMenu(n.getInsertCSSPropMenu(function(e,t){n.addRuleProperty(a,e,t||"",function(){g.refresh()},{insertAtIndex:a.nodes.indexOf(s)+1})}),t).showAt(e.pageX,e.pageY,C.$container)}}),new PgDragHelper(t,".disable---pg-table-grid-cell",null,!0));w.onGetDragImage=function(){return"none"},w.onBefore=function(e){return!d(e).no_sort},w.on("dragStart",function(e,t,s){$.fn.crsapages("showOverlays");for(var a=d(w.movedElement),n=pgCreate("<div>Dummy</div>"),i=((v=new PgDragMenu({name:"Props"},!0,!0,null,n,{dragType:"css"})).draggedNodes=pinegrow.selectedCSSNodes.getNormalizedListForNode(a.node),$('<div class="pg-tree-drag-container with-tree"></div>')),l=C.getNumberOfDescendants(a.idx,C.data)+1,o=a.level,r=0;r<l;r++){var c=C.createCellForData(C.data[a.idx+r]);c.setData(C.data[a.idx+r]),C.onSetDataToCell(C.data[a.idx+r],c),c.showAt((c.data.level-o)*C.levelPadding,r*C.cellHeight,i)}4<l&&$('<div class="pg-table-grid-cell"><name>+ '+(l-4)+" more</name></div>").appendTo(i).css({top:4*C.cellHeight+"px",left:(C.data[a.idx+4].level+1-o)*C.levelPadding+"px"}),i.css("height",Math.min(l,5)*C.cellHeight),v.addElement(i),v.movedPgel=n,v.pgel=n,C.dragStarted(a),v.handleMoveEvent(s,v),m.hide()},this),w.on("drag",function(e,t,s){v.handleMoveEvent(s,v)},this),w.on("dragStop",function(e,t){$.fn.crsapages("showOverlays",!0),C.dragStopped(),console.log(v.treeDropPosition);function s(e){var t=pgcssh.getStylesheetForNode(e);t&&n.indexOf(t)<0&&n.push(t)}function a(e){function l(e,t){if(t.nodes){var s=!1;if(pinegrow.selectedCSSNodes.isSelected(t)){for(var a=0,n=0;n<t.nodes.length;n++)t.nodes[n].pg_selected&&(s=!0,a++);g=g||s&&a<t.length}for(var i,n=0;n<t.nodes.length;n++)s&&!t.nodes[n].pg_selected||(i=pgcssh.copyNode(t.nodes[n]),pgcssh.insertNodeAt(i,e,e.nodes.length),h.push(i),l(i,t.nodes[n]))}}var t=pgcssh.copyNode(e);return pgcssh.getStylesheetForNode(e),h.push(t),r&&l(t,e),o||pinegrow.selectedCSSNodes.isSelected(e)&&(pinegrow.selectedCSSNodes.deselect(e),pinegrow.selectedCSSNodes.select(t)),o||d.push(e),t}var n=[],i=v.treeDropPosition,l=i.data.node,o=v.clone,r=!0,c=v.draggedNodes,d=[],h=[],g=!1;switch(s(l),i.position){case"bottom":for(var p=c.length-1;0<=p;p--)pgcssh.insertNodeAfter(a(c[p]),l);break;case"top":for(p=0;p<c.length;p++)pgcssh.insertNodeBefore(a(c[p]),l);break;case"inside-top":for(p=c.length-1;0<=p;p--)pgcssh.insertNodeAt(a(c[p]),l,0);break;case"inside-bottom":for(p=0;p<c.length;p++)pgcssh.insertNodeAt(a(c[p]),l.nodes.length)}g&&(o=!0,d=[]),d.forEach(function(e){s(e),pgcssh.removeNodeFrom(e)}),h.forEach(function(e){var t=pgcssh.getStylesheetForNode(e);t&&t.addIdsToNodes([e])}),pinegrow.selectedCSSNodes.update(),$("body").trigger("crsa-rules-changed",{list:n}),n.forEach(function(e){pinegrow.stylesheets.applyToPages(e)}),v.destroy(),v=null,crsaFuncs.showInsertionLine(null),pinegrow.highlightElement(null)},this),h.onResize=function(){};const P=new ResizeObserver(function(){T?T=!1:(f=C.$element.get(0).getBoundingClientRect(),C.onRepaint(),C.updateLayout(),C.updateContainerSize(),C.refresh(),m.updateLayout())});P.observe(C.$element.get(0)),f=C.$element.get(0).getBoundingClientRect(),h.onDestroy=function(){P.disconnect(),pinegrow.removeEventHandler("on_selected_elements_changed",k),pinegrow.removeEventHandler("on_page_changed",S),pinegrow.removeEventHandler("on_page_loaded",F),pinegrow.removeEventHandler("on_page_refreshed",F),pinegrow.removeEventHandler("on_page_selected",W),pinegrow.removeEventHandler("on_drag_drop_operation_done",L),pinegrow.removeEventHandler("on_page_frameworks_changed",I),pinegrow.removeEventHandler("on_element_isolated",N),C.$element.off("mousemove",B),C.$element.off("mouseleave",j),C.$element.off("mouseenter",Y)};var S=function(e,t,s){s&&s.source===g||g.show()},y=function(e){C.showInsertionLineAt(-1),C.setEmptyLineAt(-1),C.borderItem(null),e?(e.setFilterOptions(l),e.setTreeView(g),e.setTableGrid(C)):(D=null,C.setData([]),m.hide()),m.updateLayout()},b=null,T=!1,k=(this.show=function(e){x(e)},this.refresh=function(){b.create(A),y(b)},function(e,t,s){s&&s?.source===g?g.refresh():x()}),A=null,E=null,x=function(s){h.whenVisible(function(){f=C.$element.get(0).getBoundingClientRect();var e,t=pinegrow.selectedElements.getLastSelected();u=pinegrow.getSelectedPage(),t&&t.getPage()&&(e=new CrsaProfile(!0,"Show active classes"),A=new PgActiveClassesForPgel(t,g),(b=new PgClassTree).create(A),y(b),E!==t&&C.$element.scrollTop(0),E=t,e.show("Tree shown"),s)&&s()})},F=function(e){},I=function(e){},N=function(e,t){},W=function(e){},L=function(e,t){},D=null,V=null,R=new PgMouseSpeed,O=null,H=null,B=function(e){f=C.$element.get(0).getBoundingClientRect();var t={left:e.pageX-f.left,top:e.pageY-f.top-0};if(R.track(e),D&&m.isHidden()&&m.show(),H&&(clearTimeout(H),H=null),t&&u){var s=C,a=s.getScrollOffset(),n=(t.top+=a.top,t.left+=a.left,3),i=5,a=s.getVisibleDataIndexForY(t.top,!0);if(0<=a)for(var l=s.getYForVisibleDataIndex(a),o=a;o<s.visibleData.length;){var r=s.getYForVisibleDataIndex(o);if(l<r)break;var c=s.visibleData[o].node;if("rule"!==c.type&&"decl"!==c.type&&"add_prop"!==c.type&&("comment"!==c.type||"rule"!==c.parent.type))break;var c=s.getXForVisibleData(s.visibleData[o]),d=s.getCellWidthForData(s.visibleData[o]),h=!0,g=c+d+9999;if(0!==d&&s.visibleData.length>o+1&&s.getYForVisibleDataIndex(o+1)===r&&(h=!1,g=s.getXForVisibleData(s.visibleData[o+1])),c<=t.left&&t.left<=g){var g=!1,p="bottom";if(h?(r+s.getCellHeightForData(s.visibleData[o])-n<=t.top||0!==d&&c+d-i<t.left)&&(g=!0):(p="right",(c+d-i<=t.left||c+d<=t.left)&&(g=!0)),g)return s.quickInsertLine.show(s.visibleData[o],s.visibleData[o].level,p),O||C.$container.addClass("with-insert-position"),void(O={data:s.visibleData[o],pos:p});break}o++}O&&C.$container.removeClass("with-insert-position"),O=null,s.quickInsertLine.show(null)}},j=function(e){C.highlightLevel(-1),C.quickInsertLine.hide(),H&&(clearTimeout(H),H=null),m.hide(),V&&V.$element.removeClass("hovered"),V=null},Y=function(e){D&&m.show()},z=(C.$element.on("mousemove",B),C.$element.on("mouseleave",j),C.$element.on("mouseenter",Y),pinegrow.addEventHandler("on_selected_elements_changed",k),pinegrow.addEventHandler("on_page_changed",S),pinegrow.addEventHandler("on_page_loaded",F),pinegrow.addEventHandler("on_page_refreshed",F),pinegrow.addEventHandler("on_page_selected",W),pinegrow.addEventHandler("on_drag_drop_operation_done",L),pinegrow.addEventHandler("on_element_isolated",N),pinegrow.addEventHandler("on_page_frameworks_changed",I),function(){var e;D&&(e=C.getScrollOffset(),e=C.getYForVisibleDataIndex(D.visible_idx)-e.top,m.showFor(e,e+C.cellHeight,D.selected||!1,D))});this.onSelected=function(e){D=e;var t=this.getPgel(e);t&&m.find("hide").find("i").removeClass("icon-hide icon-see").addClass(t.isHidden()?"icon-see":"icon-hide"),z()},this.onDeselected=function(e){pinegrow.selectedElements.hasSelection()||(D=null,m.hide())}},PgClassTree=function(){var a,l,o={styles:!1,images:!1},r=!1,c=[],n={},d=(this.flag_expanded=null,this.flag_related=null,this.setFilterOptions=function(e){var t=r;r=!1,$.each(e,function(e,t){if(t)return r=!0}),o=e,f=t!==r},this.setTreeView=function(e){l=e},null),t=(this.setTableGrid=function(e){d=e,this.$element=d.$element,e.setData(c),f&&this.research()},$("<div/>").addClass("crsa-tree-branch pg-tree-ul"),this.$element=null,this.highlightOnMouseOver=!0,this.destroy=function(){nextFrame.cancelAll(),l=d=null,a&&a.destroy(),n=c=a=null},this.getDataFor$Element=function(e){return d.getDataFor$Element(e)},this.updatePgIdMap=function(){var e=new CrsaProfile;n={},c.forEach(function(e){e.pgid&&(n[e.pgid]=e)}),e.show("updatePgIdMap")},function(e){return n[e]||null});this.getTreeDataItemForPgId=function(e){return t(e)};const h=1,g=3,p=2;var u=null,f=(this.research=function(e){var t={selected_ids:{},changed:!1};(u||t.changed||r||e)&&this.search(u,!0,t)},!1),i=(this.search=function(e,n,t){var i,s;l?(f=!1,i=0<(e=null===e?"":e).length?new RegExp(escapeRegExp(e),"i"):null,u=e,(s=t||{selected_ids:{},changed:!1}).selected_ids,s=s.changed,e||s||r?a&&(c.forEach(function(e){e.search=0,e.peek_in&&(e.collapsed=!0,e.peek_in=!1)}),a.forEachWithParents(function(e,t){var s=!1;if(i&&!e.search_string.match(i)||(s=!0),s=r&&o.position?"decl"===e.node.type&&s&&null!==("_"+e.node.prop+"_").match(/_(top|right|bottom|left|position|z\-index)_/i):s){e.search=h;for(var a=t.length-1;0<=a&&t[a].search===g;a--)t[a].search=p,t[a].collapsed&&(t[a].peek_in=!0),t[a].collapsed=!1}else if(0&&e.force_search&&n)for(a=t.length-1;0<=a&&t[a].search===g;a--)t[a].search=p;else e.search=g}),d.refresh()):(c.forEach(function(e){e.search=0,e.force_search=!1,e.peek_in&&(e.collapsed=!0,e.peek_in=!1)}),d.refresh())):f=!0},this.scrollToSelected=null,this.create=function(e){c=[],n={};var t=e,s=new CrsaProfile(!0);i(c,t),t.getParents().forEach(function(e){i(c,e)}),s.show("create Class Tree "+c.length+" tree data items"),(a=new PgTreeDataHelper(c)).reindexData(),this.research()},this.populateDataItem=function(e){e.populated||(e.node.populateDataItem(e),e.populated=!0)},this.createDataItem=function(t,e,s){var a={shown:!0,level:s=s||0,tags:"",search_string:""},a=(e.populateTreeFata(a),a.classes="sort",a.collapsed=v(e),a.no_sort=!1,t.push(a),e.getTreeChildren());a&&a.forEach(function(e){i(t,e,s+e.level_offset)})}),v=function(e){return!1}};class PgFastDOMClassPreviewForElement{constructor(e,t){this.el=e,this.original=this.el.getAttribute("class"),this.prefix=t||"",this.my_last=this.original}setClass(e,t,s){var a=this;this.my_last,this.el.getAttribute("class"),this.restore(),s?s($(this.el),a.prefix+e):(t&&t.forEach(function(e){a.el.classList.contains(a.prefix+e.key)&&a.el.classList.remove(a.prefix+e.key)}),e&&e.split(/\s+/).forEach(function(e){e&&a.el.classList.add(a.prefix+e)})),this.my_last=this.el.getAttribute("class")}restore(){this.el.setAttribute("class",this.original),this.my_last=this.original}remember(){this.original=this.el.getAttribute("class"),this.my_last=this.original}}var pgActiveFastDOMClassPreviewForPgel=null;class PgFastDOMClassPreviewForPgel{constructor(e,t){this.enabled=!0,this.destroyed=!1,pgActiveFastDOMClassPreviewForPgel?this.enabled=!1:(this.pgel=e,this.page=e.getPage(),this.$elements=e.get$DOMElements(),this.list=this.$elements.map(function(e){return new PgFastDOMClassPreviewForElement(e.get(0),t)}),this.hidden_menus=!1,this.prefix=t||"",pinegrow.dispatchEvent("on_fast_dom_class_preview_start",this.page,this.pgel))}triggerPreviewEvent(e,t){var s,a;this.enabled&&(s=this,(a=t.map(function(e){return s.prefix+e.key})).push(this.prefix+e),pinegrow.dispatchEvent("on_fast_dom_class_preview",this.page,this.pgel,this.prefix+e,a))}setClass(t,s,a){this.enabled&&!this.destroyed&&(this.hidden_menus||(pinegrow.selectedElements.temporaryHideMenus(!0),this.hidden_menus=!0),this.list.forEach(function(e){e.setClass(t,s,a)}),t)&&this.triggerPreviewEvent(t,s)}remember(){this.destroyed||this.enabled&&this.list.forEach(function(e){e.remember()})}showMenus(){this.enabled&&this.hidden_menus&&(pinegrow.selectedElements.restoreShowMenus(!0),this.hidden_menus=!1)}restore(){this.destroyed||this.enabled&&(this.list.forEach(function(e){e.restore()}),this.showMenus())}destroy(e){this.destroyed||this.enabled&&(e||this.restore(),this.showMenus(),pinegrow.dispatchEvent("on_fast_dom_class_preview_end",this.page,this.pgel),this.destroyed=!0,pgActiveFastDOMClassPreviewForPgel===this)&&(pgActiveFastDOMClassPreviewForPgel=null)}}class PgClassStateComposerDropdown{constructor(){this.states=null,this.custom=null,this.order=[],this.all_states=["hover","focus","active","visited","disabled","group-hover","group-focus","group-active","group-visited","first","last","odd","even","dark","sm","md","lg","xl","2xl"],this.order=["dark","sm","md","lg","xl","2xl","hover","focus","active","visited","disabled","group-hover","group-focus","group-active","group-visited","first","last","odd","even"],this.screens=["sm","md","lg","xl","2xl"],this.popular_states=[]}onChanged(){}isCustom(e,t){if(0<=e.indexOf("["))return!0;for(var s=0;s<t.length;s++)if(this.order.indexOf(t[s])<0)return!0;return e!==this.getOrderedValue(t)}setValue(e){this.custom=null,this.states=""===e?[]:e.split(":"),this.isCustom(e,this.states)&&(this.custom=e)}getValue(){return this.custom||this.getOrderedValue(this.states)}getOrderedValue(e){for(var s={},t=0;t<e.length;t++){var a=this.order.indexOf(e[t]);s[e[t]]=a}var n=e.slice(0);return n.sort(function(e,t){return s[t]<s[e]?1:s[e]===s[t]?0:-1}),n.join(":")}editCustom(){var t=this,e="";this.custom&&(e=`<p>This is a custom variant. You can only edit it in text mode.</p>`),pinegrow.showPrompt(e+`<p>Variant:</p>`,"Edit custom variant",this.getValue(),"md:hover",null,function(e){t.setValue(e),t.onChanged()})}show(e){var t,s,a,n=this;this.custom?this.editCustom():(t=[],s=function(){var s=this.key,e=n.states.indexOf(s);return 0<=e?n.states.splice(e,1):(n.states.push(s),0<=n.screens.indexOf(s)&&n.screens.forEach(function(e){var t;e!==s&&0<=(t=n.states.indexOf(e))&&n.states.splice(t,1)})),n.onChanged(),!1},a={},this.screens&&(t.push({type:"header",label:"Screen sizes"}),this.screens.forEach(function(e){t.push({label:e,action:s,key:e,check:0<=n.states.indexOf(e)}),a[e]=!0})),this.popular_states.length&&(t.push({type:"header",label:"Frequently used"}),this.popular_states.forEach(function(e){t.push({label:e,action:s,key:e,check:0<=n.states.indexOf(e)})})),this.all_states.length&&(t.push({type:"divider"}),t.push({type:"header",label:"All variants"}),this.all_states.forEach(function(e){a[e]||t.push({label:e,action:s,key:e,check:0<=n.states.indexOf(e)})})),t.push({type:"divider"}),t.push({label:"Edit...",action:function(){n.editCustom()}}),new CrsaContextMenu(t,$(e.target)).showAt(e.pageX,e.pageY))}}class PgClassStateComposerView{constructor(){this.$element=$(`<div class="pg-class-state-composer">
<div class="list"></div>
<div class="selected"></div>
</div>`),this.view=new PgUIView(this.$element),this.list_el=this.$element.find(".list")[0],this.selected_el=this.$element.find(".selected")[0];new PgDraggableReorder($(this.selected_el),"[data-item]",function(e,t,s){},function(e){return"move"})}setValue(e){const t=this;var s=e.split(":"),a="";s.forEach(function(e){a+=t.getPill(e)}),this.selected_el.innerHTML=a}getValue(){this.selected_el.querySelectorAll("[data-item]")}getPill(e){return`<div class="state_item" data-item="${e}" draggable="true">${e}</div>`}}$("body").one("pinegrow-ready",function(){pinegrow.addEventHandler("on_key_pressed",function(e,t,s){"s"!==s.key||s.input||s.edit||(new PgQuickClassTree,s.done=!0)})});