$(function(){var fe;pgf.edit_css&&($("body").one("pinegrow-ready",function(e,le){function S(){function t(e){var t,n,i;(i=(e=i=e.get$DOMElement())?"grid"==(n=e.css("display"))||"inline-grid"==n?e:0!=(t=e.parent()).length&&1==t.get(0).nodeType&&("grid"==(n=t.css("display"))||"inline-grid"==n)?t:null:null)&&((n=new c).show(i),a.push(n))}a.forEach(function(e){e.destroy()}),a=[];var n=s;le.selectedElements.forEachElement(function(e){t(e),n==e&&(n=null)}),n&&t(n)}function m(e){var n;return"none"==e?null:(n=[],(e||"").split(/["']/).forEach(function(e){var t;(e=$.trim(e)).length&&(t=[],n.push(t),e.split(/\s+/).forEach(function(e){t.push(e="."==e?"":e)}))}),n)}function o(E,e){function r(e,t,n){var i=parseInt(t.attr("data-idx")),o=i<e.length?e[i]:n;le.showPrompt(`<p>Edit the track name. Track names must end with <b>-start</b> or <b>-end</b> if you wish to use grid handles for element placement along those tracks, for example <code>main-start</code>.</p><p>Separate multiple names with spaces, for example <code>main-start content-start</code>.</p><p>Leave empty to clear the track name.</p>`,"Edit track name",o.name||"","for example, content-end",null,function(e){e&&!function(e){for(var t=e.split(" "),n=0;n<t.length;n++)t[n].length;return!0}(e)?le.showQuickError("Invalid track name(s)."):(o.name=e,K(),J(!0))}),J(!0)}function t(){P.showGrid()}function n(e,t){"css"!=P.mode||t.edited_by&&"cssgridcontrol"==t.edited_by||(t.node&&t.node.parent==W||t.stylesheet.elementStyle&&!W&&t.stylesheet.element===E)&&P.showGrid(W)}function a(e,t,n){t&&t.source&&t.source==P||n&&n.contains(E)&&P.showGrid(W)}function s(){P.showGrid(W)}e=e||le.getSelectedPage().activeView;var P=this,R=(this.mode=x.mode,$('<div class="pg-dm-grid-view"></div>')),i=new PgUIView(R,"pgdmgrid"),o=(this.view=i,this.pageView=e,R.addClass(this.mode),E.getPage()),l=new PgDelayedTasks,z=(this.setDeviceDef=function(e){this.dmSizeDef=e,this.dmSizeSlug=e?e.slug:"-md"},this.setDeviceDef(e?v(e):null),[]),ee=(o.callFrameworkHandler("on_get_device_sizes",z),function(){for(var e=[],t=["c","r","a"],n="--g#SLUG-",i=0;i<z.length;i++){for(var o=!1,r=n.replace("#SLUG",z[i].slug),a=0;a<t.length;a++)if(E.getInlineStylePropertyValue(r+t[a])){o=!0;break}o&&e.push(z[i].size)}return e}),T=$('<div class="pg-dm-grid-view-selector"></div>').appendTo(R),o=$('<div class="pg-dm-grid-view-container"></div>').appendTo(R),F=$('<div class="pg-dm-grid-view-options"></div>').appendTo(o),N=$('<div class="pg-dm-grid-view-grid"></div>').appendTo(o),D=(crsaHandleExternalLinks(R),[]),I=[],V=[],h=null,m=null,G=null,A=null,M=null,O=null,H=!1,g=null,L=!1,B={},X=[],te=function(){X=[],V.forEach(function(e){e.forEach(function(e){e&&X.indexOf(e)<0&&X.push(e)})})},Y=null,W=null,p={},f=function(e,t){return ge(e,t)},ne=function(e,t){switch(void 0===t&&(t=P.dmSizeSlug),e){case"grid-template-columns":return`--g${t}-c`;case"grid-template-rows":return`--g${t}-r`;case"grid-template-areas":return`--g${t}-a`;case"grid-gap":return`--g${t}-gap`}return null},d=function(e,t){var n=pgDmStore.getSkillByKey("grid");pgDmStore.setSkillParam(E,n,e,t)},ie=function(){te(),B={};var t=0;chroma.scale(["#0497cc","#b2d12e"]).mode("lch").colors(X.length).forEach(function(e){B[X[t]]=e,t++})},u=function(e,t){return e<V.length&&t<V[e].length?V[e][t]:""},U=function(e,t){D.splice(t,0,e);var n=0;V.forEach(function(e){e.splice(t,0,u(n,t)),n++})},Q=function(e,t){I.splice(t,0,e);for(var n=[],i=0;i<D.length;i++)n.push(u(t,i));V.splice(t,0,n)},oe="1fr",re="100px",j=function(e,t){return $('<div class="pg-dm-grid-view-grid-'+e+'"></div>').appendTo(t||N)},c=new fe,q=function(e,t,n){var i=c.test(t,n);return e.setError(i?null:"Invalid value"),i},K=function(){if(se()){F.empty(),N.empty(),T.empty(),N.css("min-height","0");function o(e,t,n,i){var o=new PgInputField("size",{type:"slider",name:"W",slider_def_unit:"px",slider_min:0,without_text:!0,options:l});o.setValue(e),q(o,"grid-template-columns",e),o.on("input change",function(e){var t=o.getValue();q(o,"grid-template-columns",t)&&(n[i].size=t,J("change"===e.type))}),o.appendTo(t)}var n,i,r,t,a,s,l=[{key:"100px",name:"100px",html:"100px <small>Fixed size</small>"},{key:"1fr",name:"1fr",html:"1fr <small>Divide available space</small>"},{key:"auto",name:"auto",html:"auto <small>Content size</small>"},{key:"minmax(100px, 1fr)",name:"minmax(100px, 1fr)",html:"minmax(100px, 1fr) <small>Min 100px, max 1fr</small>"},{key:"minmax(100px, auto)",name:"minmax(100px, auto)",html:"minmax(100px, auto) <small>Min 100px, max the content size</small>"},{key:"fit-content(40%)",name:"fit-content(40%)",html:"fit-content(40%) <small>Content size, but not larger than 40%</small>"},{key:"repeat(3, 200px)",name:"repeat(3, 200px)",html:"repeat(3, 200px) <small>Repeat 3 times</small>"},{key:"repeat(auto-fill, minmax(100px, 1fr))",name:"repeat(auto-fill, minmax(100px, 1fr))",html:"repeat(auto-fill, minmax(100px, 1fr)) <small>Fill with as many cols/rows as possible</small>"},{key:"repeat(auto-fit, minmax(100px, 1fr))",name:"repeat(auto-fit, minmax(100px, 1fr))",html:"repeat(auto-fit, minmax(100px, 1fr)) <small>Fit the available cols/rows into the space</small>"},{key:"none",name:"none",html:"None <small>Track template is not defined. Only valid with a single row or column.</small>"}],e=[{key:"100px",name:"100px",html:"100px <small>Fixed size</small>"},{key:"1fr",name:"1fr",html:"1fr <small>Divide available space</small>"},{key:"auto",name:"auto",html:"auto <small>Content size</small>"},{key:"minmax(100px, 1fr)",name:"minmax(100px, 1fr)",html:"minmax(100px, 1fr) <small>Min 100px, max 1fr</small>"},{key:"minmax(100px, auto)",name:"minmax(100px, auto)",html:"minmax(100px, auto) <small>Min 100px, max the content size</small>"},{key:"fit-content(40%)",name:"fit-content(40%)",html:"fit-content(40%) <small>Content size, but not larger than 40%</small>"}];if(L=0<D.length&&0<I.length,"dm"==P.mode){for(var d=j("devices",T),u=ee(),c=new PgButtonToolbar,g=(d.prepend(c.$element.addClass("pg-tabs-toolbar")),new PgToolbarTabButtons(c,"tabs")),p=0;p<z.length;p++){var h=z[p],m=0<=u.indexOf(h.size),f=P.dmSizeDef&&h.size==P.dmSizeDef.size,f=g.addTab(h.name_short,null,h,f).setClosable(!1);m&&f.$element.append('<i class="icon icon-check"></i>'),h.name_short}g.onTabSelected=function(e){var t=e.data,n=(P.setDeviceDef(t),P.showGrid(),le.getSelectedPage());n&&n.view.setActiveViewSizeWithDef(t),P.onDeviceSizeChanged&&P.onDeviceSizeChanged(n,t)},0}if("css"==P.mode){for(var w=Y.getShownNodes(),_=new PgInputField("rule",{type:"select",name:"CSS Rule",without_text:!1,show_empty:!1,options:function(){var t=0;return[{key:"item-1",name:"Style attribute"}].concat(w.map(function(e){return{key:`item`+t++,name:pgcssh.getRuleDisplayName(e)}}))}}),v=-1,p=0;p<w.length;p++)if(w[p]===W){v=p;break}_.setValue(`item`+v),_.on("change",function(e){var t=parseInt(_.getValue().replace("item","")),t=0<=(t=Math.min(t,w.length-1))?w[t]:"style_attribute";P.showGrid(t)}),_.appendTo(T)}if(L&&(d=(d=$(`<div class="pg-css-grid-field-gaps crsa-field"><label>Gap col/row</label><div></div></div>`).appendTo(F)).find("div"),(n=new PgInputField("gap",{type:"slider",name:"Gap",slider_def_unit:"px",slider_min:0,without_text:!0})).setValue(M),q(n,"gap",M),n.on("change input",function(e){M=n.getValue(),H&&(r.setValue(M),O=M),q(n,"gap",M)&&J("change"===e.type)}),n.appendTo(d),c=new PgToggleButtonMaker,(i=new PgInputField("gap-eq",{type:"select",name:"Gap eq",show_empty:!0,toggle_buttons:!0,without_text:!0,options:[{key:"true",name:"Equal gaps",html:c.makeIcon("same",{title:"Make gaps the same."})}]})).setValue(H?"true":null),i.on("change",function(e){var t;(H="true"===i.getValue())&&(t=M||O,n.setValue(t),r.setValue(t),M=O=t),J(!0)}),i.appendTo(d),(r=new PgInputField("gap-row",{type:"slider",name:"Gap row",slider_def_unit:"px",slider_min:0,without_text:!0})).setValue(H?M:O),q(r,"gap",O),r.on("change input",function(e){O=r.getValue(),H&&(n.setValue(O),M=O),q(r,"gap",O)&&J("change"===e.type)}),r.appendTo(d),(t=new PgInputField("auto_col",{type:"slider",name:"Auto Columns",slider_def_unit:"px",slider_min:0,without_text:!1,options:e})).setValue(G),q(t,"grid-auto-columns",G),t.on("change input",function(e){G=t.getValue(),q(t,"grid-auto-columns",G)&&J("change"==e.type)}),t.appendTo(F),(a=new PgInputField("auto_row",{type:"slider",name:"Auto Rows",slider_def_unit:"px",slider_min:0,without_text:!1,options:e})).setValue(A),q(a,"grid-auto-rows",A),a.on("change input",function(e){A=a.getValue(),q(a,"grid-auto-rows",A)&&J("change"==e.type)}),a.appendTo(F),A||G||(t.$field.hide(),a.$field.hide(),(s=$('<p style="text-align:right;margin-bottom:0;"><a href="#" class="help-link show-more">Auto columns and rows...</a></p>').appendTo(F)).on("click","a",function(e){e.preventDefault(),t.$field.show(),a.$field.show(),s.hide()}))),L){R.removeClass("no-grid");var y=null,S=(j("corner").html(`<div><span>Columns</span><span>Rows</span></div>`),0),x=(D.forEach(function(e){var t=e.size,n=j("col");0!=S&&!1||$(`<i class="add-col add-col-first icon icon-plus" data-idx="${S}">`).appendTo(n),o(t,n,D,S),$(`<i class="del-col icon icon-bin" data-idx="${S}">`).appendTo(n),$(`<i class="add-col icon icon-plus" data-idx="${S+1}">`).appendTo(n),S++}),ie(),0);I.forEach(function(e){var t=e.size,n=j("row");0!=x&&!1||$(`<i class="add-row add-row-first icon icon-plus" data-idx="${x}">`).appendTo(n),o(t,n,I,x),$(`<i class="del-row icon icon-bin" data-idx="${x}">`).appendTo(n),$(`<i class="add-row icon icon-plus" data-idx="${x+1}">`).appendTo(n);for(var i=0;i<D.length;i++)!function(n,i){var o=j("cell",y),e=V[n][i],r=(o.attr("data-area",e),o.attr("data-col",i),o.attr("data-row",n),e&&o.addClass("has-area"),new PgInputField("size",{type:"text",name:"W",without_text:!0,placeholder:"area name",fill_list_on_open:!0,options:function(){te();var t=[];return X.forEach(function(e){e.length&&t.push({key:e,name:e})}),t}}));r.setValue(e),r.on("change",function(e){var t=r.getValue();V[n][i]=t,o.attr("data-area",t),t?o.addClass("has-area"):o.removeClass("has-area"),t in B?o.css({"background-color":B[t]}):(ie(),N.find(".pg-dm-grid-view-grid-cell").each(function(e,t){var n=$(t),i=n.attr("data-area");n.css({"background-color":B[i]})})),J("change"==e.type)}),r.appendTo(o),o.css({"background-color":B[e]})}(x,i);x++}),N.css({"grid-template-columns":`minmax(120px, 1fr) repeat(${D.length}, minmax(80px, 1fr))`,"grid-template-rows":`50px repeat(${I.length}, minmax(70px, 70px))`}),Z(),Z()}else{var C,b=null;if("dm"==P.mode){for(var k=0,p=0;p<z.length;p++)if(P.dmSizeDef.size==z[p].size){k=p;break}for(p=k-1;0<=k;k--)if(0<=u.indexOf(z[k].size)){b=z[k];break}if(!b)for(p=k+1;k<z.length;k++)if(0<=u.indexOf(z[p].size)){b=z[p];break}}c="dm"==P.mode?(C=`<p>CSS Grid for device size ${P.dmSizeDef.name_short} is not defined. Would you like to define it?</p>`,`Create grid for `+P.dmSizeDef.name_short):(C=`<p>CSS Grid is not defined for the selected CSS rule. Would you like to define it?</p>`,`Create CSS Grid`),$(C).appendTo(F),R.addClass("no-grid");$(`<button class="btn pg-button create-grid">${c}</button>`).appendTo(F).on("click",function(e){var i,o,t;e.preventDefault(),b?(i=b.slug,o=P.dmSizeDef.slug,t=$.extend({},ae),$.each(t,function(e,t){var n=ne(e,i);n&&(t=E.getInlineStylePropertyValue(n),n=ne(e,o),t)&&E.setInlineStylePropertyValue(n,t)}),le.showQuickMessage("Grid copied from "+b.name_short+"."),P.showGrid(),J(!0)):(U({size:oe}),U({size:oe}),U({size:oe}),Q({size:re}),K(),J(!0),P.showGrid())}),$('<p style="margin-top:40px;"><a href="'+help_url+'" class="external help-link">Learn about CSS Grid...</a></p>').appendTo(F)}}},Z=function(){if(N.is(":visible")){N.css("min-height","0");function e(e,t){var n=N.find(`.pg-dm-grid-view-grid-col-line[data-idx="${t-1}"]`),i=(0===n.length&&(n=j("col-line",N),i=`<hr><span>${t}</span>`,e.name&&(i+=`<linename>${e.name}</linename>`,n.addClass("has-name")),n.html(i),n.attr("data-idx",t-1),addTooltip(n,"Click to edit the track name.")),n.attr("style",`left:${c}px;min-width:${s-86}px;`),c+=l[t]+o,n.width());u<i&&(u=i)}for(var t=window.getComputedStyle(N.get(0)),o=_(t.gridColumnGap),r=_(t.gridRowGap),a=parseFloat(t.width.replace("px","")),s=parseFloat(t.height.replace("px","")),l=t.gridTemplateColumns.split(" ").map(function(e){return parseFloat(e.replace("px",""))}),d=t.gridTemplateRows.split(" ").map(function(e){return parseFloat(e.replace("px",""))}),u=0,c=l[0]+o/2,n=1;n<l.length;n++)e(D[n-1],n);e(h,l.length),N.css("min-height",u+86+"px");function i(e,t){var n,i=N.find(`.pg-dm-grid-view-grid-row-line[data-idx="${t-1}"]`);0===i.length&&(i=j("row-line",N),n=`<hr><span>${t}</span>`,e.name&&(n+=`<linename>${e.name}</linename>`,i.addClass("has-name")),i.attr("data-idx",t-1),i.html(n),addTooltip(i,"Click to edit the track name.")),i.attr("style",`left:${g}px;top:${p}px;min-width:${a-g}px;`),p+=d[t]+r}for(var g=l[0]+o+2,p=d[0]+r/2,n=1;n<d.length;n++)i(I[n-1],n);i(m,d.length)}},J=(i.onResize=function(){L&&w&&(Z(),Z())},N.on("click",".add-col",function(e){var t=$(this),t=parseInt(t.attr("data-idx")),n={size:(t<D.length?D[t]:D[t-1]).size};t==D.length&&(n.name=h.name,h.name=null),U(n,t),K(),J(!0)}),N.on("click",".del-col",function(e){var t,n=$(this),n=parseInt(n.attr("data-idx"));t=n,D.splice(t,1),V.forEach(function(e){e.splice(t,1)}),K(),J(!0)}),N.on("click",".add-row",function(e){var t=$(this),t=parseInt(t.attr("data-idx")),n={size:(t<I.length?I[t]:I[t-1]).size};t==I.length&&(n.name=m.name,m.name=null),Q(n,t),K(),J(!0)}),N.on("click",".del-row",function(e){var t,n=$(this),n=parseInt(n.attr("data-idx"));t=n,I.splice(t,1),V.splice(t,1),K(),J(!0)}),N.on("click",".pg-dm-grid-view-grid-col-line",function(e){var t=$(this);r(D,t,h)}),N.on("click",".pg-dm-grid-view-grid-row-line",function(e){var t=$(this);r(I,t,m)}),N.on("mouseover",".pg-dm-grid-view-grid-cell",function(){var e=$(this),t=e.attr("data-col"),e=e.attr("data-row");P.onHighlightCell&&P.onHighlightCell(t,e)}),N.on("mouseout",".pg-dm-grid-view-grid-cell",function(){P.onHighlightCell&&P.onHighlightCell()}),function(e){var t;se()&&(t=function(){var n=[],e=P.getCSS();$.each(e,function(e,t){t=(t="none"===t?null:t)&&t.replace(/"/g,"'"),n.push({prop:e,val:t})});for(var t=0;t<n.length;t++)"css"===P.mode?he(E,W,n[t].prop,n[t].val,t!==n.length-1):d(n[t].prop,n[t].val)},W=pe(W),e?(t(),me(E,W,"Set CSS grid",null,{source:P}),l.run("refreshCssPanel",function(){var e=null;W&&(e=pgcssh.getStylesheetForNode(W)),le.activeCSSView.refreshCurrentDisplay(e)},1e3)):t(),P.onChange)&&P.onChange()}),ae={"grid-template-columns":null,"grid-template-rows":null,"grid-template-areas":null,"grid-auto-columns":null,"grid-auto-rows":null,gap:null,"column-gap":null,"row-gap":null,display:null},se=function(){var e=E;return(E=E&&(E.replacedWith||getPgNodeByPgId(E.getId())))&&E!==e&&(Y&&Y.destroy(),Y=new PgActiveRules(E)),!!E||(le.showQuickError("The target element doesn't exist any more. Please close the CSS Grid editor."),!1)},w=!1,Y=new PgActiveRules(E);this.showGrid=function(c){var e;se()&&(w=!1,e=function(){D=[],I=[],V=[],O=M=A=G=null,p=$.extend({},ae),w=!0;var e,n,t,i,o,r,a,s,l=Y.getActiveNodes(),d=(W=null,"css"===this.mode&&(t=!1,c&&("style_attribute"===c?(W=null,t=!0):0<=Y.getShownNodes().indexOf(c)&&(W=c,t=!0)),t||(e=l,W=ue(E,t=["grid-template-rows","grid-template-columns","grid","grid-template","grid-template-areas","grid-auto-columns","grid-auto-rows"])?null:ce(e,t,!1))),"css"===this.mode?(n={gap:"grid-gap","column-gap":"grid-column-gap","row-gap":"grid-row-gap"},$.each(p,function(e,t){W?(p[e]=f(W,e),!p[e]&&n[e]&&(p[e]=f(W,n[e]))):(p[e]=E.getInlineStylePropertyValue(e),!p[e]&&n[e]&&(p[e]=E.getInlineStylePropertyValue(n[e])))})):$.each(p,function(e,t){var n;p[e]=(e=e,n=pgDmStore.getSkillByKey("grid"),pgDmStore.getSkillParam(E,n,e))}),l=p["grid-template-columns"],t=p["grid-template-rows"],i=p["grid-template-areas"],o=p["grid-auto-columns"]||null,r=p["grid-auto-rows"]||null,a=p["gap"]||p["column-gap"],p["column-gap"],s=p["row-gap"],g=null,g="inline-grid"!==p["display"]?"grid":"inline-grid",t=t||"",h={size:"",name:null},m={size:"",name:null},G=o,A=r,M=a,O=s,H=!!p["gap"]||M===O,0),u=(y(l=l||"").forEach(function(e){e.size;e.last?h=e:U(e,d++)}),d=0,y(t).forEach(function(e){e.size;e.last?m=e:Q(e,d++)}),0==D.length&&I.length?U({size:"none"}):0==I.length&&D.length&&Q({size:"none"}),0);(i||"").split(/["']/).forEach(function(e){var t;(e=$.trim(e)).length&&(t=0,e.split(/\s+/).forEach(function(e){"."==e&&(e=""),u<I.length&&t<D.length&&(V[u][t]=e),t++}),u++)}),K()},Y.clearCallbackList(),Y.updateMatchedRules(!0,function(){e.call(P)}))},this.getCSS=function(){function e(e){var t=e.size;return t=e.name?"["+e.name+"] "+t:t}var t=D.map(e).join(" "),n=I.map(e).join(" "),i=de(V,!0),o=g,r=M,a=H?r:O,o=("none"!=t&&"none"!=n||(i=null),(t="none"==t?null:t)&&h.name&&(t+=` [${h.name}]`),(n="none"==n?null:n)&&m.name&&(n+=` [${m.name}]`),0!=D.length&&0!=I.length||(a=r=i=n=t=o=null),{display:o,"grid-template-columns":t,"grid-template-rows":n,"grid-template-areas":i,"grid-auto-columns":G,"grid-auto-rows":A,gap:null,"column-gap":null,"row-gap":null});return r===a?o.gap=r:(o["column-gap"]=r,o["row-gap"]=a),o},this.showGrid(),le.addEventHandler("on_page_view_resized",t),le.addEventHandler("on_active_page_view_changed",t),le.addEventHandler("on_css_node_deleted",n),le.addEventHandler("on_css_node_updated",n),le.addEventHandler("on_css_node_added",n),le.addEventHandler("on_page_changes_done",a),le.addEventHandler("on_undo_redo",s),i.onDestroy=function(){le.removeEventHandler("on_page_view_resized",t),le.removeEventHandler("on_active_page_view_changed",t),le.removeEventHandler("on_css_node_deleted",n),le.removeEventHandler("on_css_node_updated",n),le.removeEventHandler("on_css_node_added",n),le.removeEventHandler("on_page_changes_done",a),le.removeEventHandler("on_undo_redo",s),l.destroy()}}function i(e){return"string"==typeof e&&e.match(/^[^0-9\-\_][a-zA-Z\_\-0-9]*$/)}var x=new PgFramework("pg.css.grid","CSS Grid"),r=(x.type="pg.css.grid",x.allow_single_type=!0,x.description="CSS Grid",x.author="Pinegrow",x.author_link="https://pinegrow.com",x.has_actions=!1,x.show_in_manager=!1,x.default=!0,x.setScriptFileByScriptTagId("plugin-pgcssgrid"),le.addFramework(x),x.mode="css",pgIsDev(),help_url="https://pinegrow.com/docs/css-grid/",le.addEventHandler("on_set_inline_style",function(e,t){t.css+=`
    .pinegrow-ui-helper-css-grid {
        position:absolute;
        left:0;
        top:0;
        right:0;
        bottom:0;
        pointer-events: none !important;
        display: none !important;
        grid-column: unset !important;
        grid-row: unset !important;
        grid-area: unset !important;
        background: transparent !important;
    }
    .crsa-show-css-grid .pinegrow-ui-helper-css-grid {
        display:block !important;
    }
    .pinegrow-ui-helper-relative {
        position: relative !important;
        }
        .pinegrow-ui-helper-css-grid-cell {
            position: absolute !important;
            pointer-events: none !important;
            outline:1px dashed var(--pg-grid-outline) !important; 
            outline-offset: 0 !important;
            z-index: 101 !important;
            filter: drop-shadow(0px 0px 0px rgba(255, 255, 255, 0.5)) !important;
            background: transparent !important;
        }
        
        .pinegrow-ui-helper-css-grid-hl > pgdiv > .pinegrow-ui-helper-css-grid-cell {
            background-color: #009fff1c;
        }
        .pinegrow-grid-cell-during-resize {
            z-index: 100 !important;
            width: 100% !important;
            height: 100% !important;
            box-sizing: border-box !important;
        }
        .pinegrow-grid-during-resize > pgdiv > .pinegrow-ui-helper-css-grid-cell {
            min-height: 20px !important;
            min-width: 20px !important;
        }
        .pinegrow-ui-helper-css-grid-cell-highlight {
            background-color: #009fff1c !important;
        }
`}),new PgPageViewHelper("CSS grid","css-grid-helper","crsa-show-css-grid",$("<div></div>"),`html { --pg-grid-outline: #COLOR#;}`,"1",null,!0,"gray")),a=[],s=null,_=(le.addEventHandler("on_page_changes_done",function(e,t){S()}),le.addEventHandler("on_css_applied_to_pages",function(e){S()}),le.addEventHandler("on_selected_elements_changed",function(e){S()}),le.addEventHandler("on_page_view_resized",function(){S()}),le.addEventHandler("on_get_menu_commands",function(e,t,n,i){n.push({icon:"icon-grid",tooltip:"Edit CSS grid "+pgShowKbd("CMD+G"),action:function(){k(t)}})}),le.addEventHandler("on_build_actions_menu",function(e,t,n,i){t.push({label:"Edit CSS Grid...",kbd:"CMD G",action:function(){k(n)}})}),function(e){return"string"==typeof(e=e||0)&&(e=e.replace("px","")),isNaN(e)?0:parseFloat(e)}),C=null,b=[],l=x.gridGetMenuPointsWithCallback=function(e,u,c,g,p){var t,h,m,f,w,_,v,n,y=[];(c.pageView.isActive()||p)&&(r.getCurrentValue()||p)&&0!==c.$el.length&&"HTML"!==c.$el.get(0).tagName&&0!==c.$el.parent().length&&(v=new P(c.$el),t=new P(c.$el.parent()),h=new d(c.$el,v),C=u.getData("cssGridActiveRule"),!v.isGrid()||t.isGrid()&&h.isCell()?(n=c.$el.parent()).length&&1==n.get(0).nodeType&&(v=t,h.grid_info=v,h.update(),v.isGrid()&&h.isCell()?(m=C,p||(C=null),w=!1,"css"==x.mode&&(new CrsaProfile,(_=new PgActiveRules(c.pgel)).getMatchedRules(function(e){b=e;var i,t,n,o,r,a=["grid-area","grid-column-start","grid-column-end","grid-row-start","grid-row-end","grid-row","grid-column"],s=(m&&("style_attribute"==m?(f=null,w=!0):0<=b.indexOf(m)&&(f=m,w=!0)),w||ue(c.pgel,a)&&(f=null,w=!0),w||(f=ce(_.getActiveNodes(),a,!1))||le.selectedElements.isSelectedElement(c.pgel)&&(a=le.getSelectedRule())&&"Style attribute"===(f=a).selector&&(f=null),h.getAreaName()),a=(h.colRowPosition=h.getCellColRowPosition(),!1);if(s&&"auto"!==s?(i="area",d=' <areaname style="position: relative;top: -2px;">'+s+"</areaname>"):h.isAutoPlaced()?(i="auto",d=""):(i="fixed",d="",a=!0),p||((t=new R("right",c,"column-end",v,h)).active_css_rule=f,t.onDragStarted=S,y.push(t),(n=new R("left",c,"column-start",v,h)).active_css_rule=f,n.onDragStarted=S,y.push(n),(o=new R("top",c,"row-start",v,h)).active_css_rule=f,o.onDragStarted=S,y.push(o),(r=new R("bottom",c,"row-end",v,h)).active_css_rule=f,r.onDragStarted=S,y.push(r)),s||1){function l(){var e=v.getAvailableAreas(),t=[{label:"Edit parent grid...",kbd:"CMD G",action:function(){k(u.parent)}},{label:"Edit item grid...",action:function(){k(u)}}];if((e.length||1)&&(t.unshift({type:"header",label:"Grid"}),t.unshift({type:"divider"})),t.unshift({label:"Auto positioned",check:"auto"==i,action:function(){f=pe(f),"auto"!=i?(E(u,f,null),me(u,f,"Auto position")):(E(u,f,h.getGridAreaShorthand(h.autoToFixedPlace())),me(u,f,"Cols &amp; rows position")),le.selectedElements.reselect()}}),t.unshift({type:"header",label:"Grid item"}),(e.length||1)&&(t.unshift({type:"divider"}),t.unshift({label:"Set named area...",action:function(){le.showPrompt(`<p>Enter the name of the new CSS grid area:</p>`,"Create &amp; set new CSS grid area",null,"areaname",null,function(i){var o,r;f=pe(f),(i=$.trim(i)).length&&i.match(/^[a-z][a-z0-9\_\-]*$/i)?(o=u.parent,(r=new PgActiveRules(o)).getMatchedRules(function(){var e=r.getActiveNodes(),t=null,n=["grid-template-areas","grid-template-columns","grid-template-rows","grid-auto-columns","grid-auto-rows"],e=(ue(o,n)||(t=ce(e,n)),h.getCellColRowPosition(!0));v.createNamedArea(o,t,i,e["grid-column-start"],e["grid-row-start"],e["grid-column-end"],e["grid-row-end"])?(he(u,f,"grid-area",i),me(u,f,"Set named area to "+i),le.selectedElements.reselect()):le.showQuickError("Sorry, couldn't create the new named area.")})):le.showQuickError("Invalid area name.")})}}),s&&0&&t.unshift({label:"Update area "+s,action:function(){var n=u.parent,i=new PgActiveRules(n);i.getMatchedRules(function(){var e=i.getActiveNodes(),t=["grid-template-areas","grid-template-columns","grid-template-rows","grid-auto-columns","grid-auto-rows"],e=(ue(n,t)||(grid_rule=ce(e,t)),h.getCellColRowPosition(!0));v.createNamedArea(n,grid_rule,s,e["grid-column-start"],e["grid-row-start"],e["grid-column-end"],e["grid-row-end"])||le.showQuickError("Sorry, couldn't create the new grid area.")})}}),e.forEach(function(e){t.unshift({label:e,action:function(){f=pe(f),he(u,f,"grid-area",e),me(u,f,"Set named area to "+e),le.selectedElements.reselect()},check:s==e})}),t.unshift({type:"header",label:"Set named area:"})),b){t.unshift({type:"divider"});for(var n=b.length-1;0<=n;n--)!function(e){t.unshift({label:pgcssh.getRuleDisplayName(e),check:e===f,action:function(){C=e,u.setData("cssGridActiveRule",e),le.selectedElements.reselect()}})}(b[n]);t.unshift({label:"Style attribute",check:null===f,action:function(){C="style_attribute",u.setData("cssGridActiveRule",C),le.selectedElements.reselect()}}),t.unshift({type:"header",label:"CSS Rule for changes:"})}return t}var d='<i class="icon icon-template"></i>'+d,d=("css"===x.mode&&(d+=f?"<rulename>"+pgcssh.getRuleDisplayName(f)+"</rulename>":"<rulename>Style attribute</rulename>"),new PgElementPageViewMenuPointButton(c,d));d.tooltip="Click for CSS grid item options.",y.push(d);if(p)return void g(l());d.onClick=function(){var e=l();new CrsaContextMenu(e,this.$element).showForElement(this.$element,this.$element.closest(".page"))},t.setIsNotSet(!a),n.setIsNotSet(!a),o.setIsNotSet(!a),r.setIsNotSet(!a),t.area_name_point=d,n.area_name_point=d,o.area_name_point=d,r.area_name_point=d}g(y)}))):p&&g([{label:"Edit grid...",action:function(){k(u)}}])):(n=new PgElementPageViewMenuPointButton(c,'<i class="icon icon-grid"></i>'),y.push(n),p?g([{label:"Edit grid...",action:function(){k(u)}}]):n.onClick=function(){k(u)}))},k=(le.addEventHandler("on_get_menu_points_with_callback",function(e,t,n,i){l(e,t,n,i,!1)}),le.addEventHandler("on_inserted_with_dragdrop",function(e,t){var n,i;t.gridPosition&&(n=`${t.gridPosition.row+1} / ${t.gridPosition.col+1} / ${t.gridPosition.row+2} / `+(t.gridPosition.col+2),i=function(e){var t;"css"==x.mode&&(E(e,t=null,n),me(e,t,"Set position in grid"))},t.inserted_elements.forEachElement(function(e){i(e)}),t.moved_elements.forEachElement(function(e){i(e)}))}),function(i,e){var t=new n(s=i,e||$("body"));S(),t.gridView.onChange=function(){S()},t.gridView.onDeviceSizeChanged=function(e,t){S()},t.gridView.onHighlightCell=function(e,t){var n=i.get$DOMElement();n&&((n=n.find("> .pinegrow-ui-helper-css-grid")).find("> .pinegrow-ui-helper-css-grid-cell-highlight").removeClass("pinegrow-ui-helper-css-grid-cell-highlight"),void 0!==e)&&void 0!==t&&n.find('[data-col-row="'+e+"-"+t+'"]').addClass("pinegrow-ui-helper-css-grid-cell-highlight")},t.win.onDestroy=function(){s=null,S()}}),v=(le.showCSSGridControl=k,le.addEventHandler("on_key_pressed",function(e,t,n){var i,o;"g"==n.key&&n.ctrl&&!n.edit&&(n.done=!0,i=le.selectedElements.getLastSelected())&&(o=i.get$DOMElement(),!new P(o).isGrid()&&(o=i.parent.get$DOMElement(),new P(o).isGrid())?k(i.parent):k(i))}),function(e){return e&&e.currentStandardSizeDef?e.currentStandardSizeDef:null}),y=function(e){function n(n,e){n.name=e.replace(/[\[\]]/g,""),n.names=n.name.split(/\s+/).map(function(e){var t={name:e,name_parsed:e.replace(/(\-start|\-end)$/g,""),start:null};return e.endsWith("-start")?t.start=!0:e.endsWith("-end")&&(t.start=!1),t}),n.getName=function(e){for(var t=0;t<n.names.length;t++)if(n.names[t].start===e)return n.names[t].name_parsed;return null}}var t,i=[],o=null;return splitCssValue(e,!1,/[\(\[]/,/[\)\]]/,!0).forEach(function(e){var t;e.startsWith("[")?o=e:(t={size:e},o&&(n(t,o),o=null),i.push(t))}),o&&(n(t={size:"",last:!0},o),i.push(t)),i},de=function(e,t){var n=!1,i="";return e.forEach(function(e){i.length&&(i+=" "),i=(i+=`"`)+e.map(function(e){return"."!=(e=0==$.trim(e).length?".":e)&&(n=!0),e}).join(" ")+`"`}),!n&&t?null:i},ue=function(e,t){for(var n=0;n<t.length;n++)if(e.getInlineStylePropertyValue(t[n]))return!0;return!1},ce=function(e,t,n){if(e=e||le.pgActiveRules.getActiveNodes()){var i=null;if(n){i=le.getSelectedRule();if(i&&0<=e.nodes_to_show.indexOf(i))if(!pgcssh.getStylesheetForNode(i).elementStyle)return i}if(e.nodes_to_show)for(var o=0;o<e.nodes_to_show.length;o++)for(var r=0;r<e.nodes_to_show[o].node.nodes.length;r++){var a=e.nodes_to_show[o].node.nodes[r];if("decl"==a.type&&0<=t.indexOf(a.prop))return i=e.nodes_to_show[o].node}}return null},ge=function(e,t){for(var n=0;n<e.nodes.length;n++){var i=e.nodes[n];if("decl"===i.type&&i.prop===t)return i.value}},pe=function(e){var t,n;return e=e&&(n=pgcssh.getStylesheetForNode(e))&&pgcssh.getRootNodeFor(e)!==n.getRootNode()&&(t=pgcssh.getNodeIndices(e),n=pgcssh.getNodeByIndices(n.getRootNode(),t))?n:e},he=function(e,t,n,i,o){var r,a={gap:"grid-gap","column-gap":"grid-column-gap","row-gap":"grid-row-gap"};t?(r=pgcssh.getStylesheetForNode(t),a[n]&&ge(t,a[n])&&r.ruleValueChanged(t,a[n],null,null,!1,"cssgridcontrol",!1,null,null,null,null,!0),r.ruleValueChanged(t,n,i,function(){r.inline},!1,"cssgridcontrol",!1,null,null,null,null,o)):(a[n]&&e.setInlineStylePropertyValue(a[n],null),e.setInlineStylePropertyValue(n,i))},E=function(e,t,n){he(e,t,"grid-column",null,!1),he(e,t,"grid-row",null,!1),he(e,t,"grid-column-start",null,!1),he(e,t,"grid-column-end",null,!1),he(e,t,"grid-row-start",null,!1),he(e,t,"grid-row-end",null,!1),he(e,t,"grid-area",n)},me=function(e,t,n,i,o){var r;t?(r=pgcssh.getStylesheetForNode(t),le.dispatchEvent("on_css_node_updated",null,{node:t,stylesheet:r,edited_by:i,undoRuleName:n})):(le.changeManager.didChange(e,n,o),le.dispatchEvent("on_css_attribute_style_changed",e.getPage(),e))},n=function(e,t){var n=this.gridView=new o(e),i=this.win=new PgQuickWindow("CSS Grid for "+e.getName({short:!0}),n,"quickCSSGridControl",600,600,null,!0);i.noRightEdge(),i.onFloatingChanged=function(){n.showGrid()},i.showFor$El(t||e.get$DOMElement(),!0),i.addIconToHeader("icon-271","Learn more about CSS grid.",function(){le.openExternalUrl(help_url)})},P=function(e,t){var n,i=e.get(0);if(this.$el=e,this.el=i,this.s=null,1==i.nodeType&&(n=this.s=window.getComputedStyle(i)),t){for(var o,r=e,a=n;!this.isGrid(a)&&r.length;)(r=r.parent()).length&&1==(o=r.get(0)).nodeType&&(a=window.getComputedStyle(o));r.length&&(n=this.s=a,this.$el=e=r,this.el=e.get(0))}this.update(),this.position=n.position},d=(P.prototype.update=function(){this.s&&(this.cols=y(this.s.gridTemplateColumns).map(function(e){return e.value=parseFloat(e.size.replace("px","")),e}),this.num_of_cols=this.cols.length,0<this.num_of_cols&&this.cols[this.num_of_cols-1].last&&this.num_of_cols--,this.rows=y(this.s.gridTemplateRows).map(function(e){return e.value=parseFloat(e.size.replace("px","")),e}),this.num_of_rows=this.rows.length,0<this.num_of_rows&&this.rows[this.num_of_rows-1].last&&this.num_of_rows--,this.gap_col=_(this.s.gridColumnGap),this.gap_row=_(this.s.gridRowGap),this.rect=this.el.getBoundingClientRect())},P.prototype.createNamedArea=function(e,t,n,i,o,r,a){i=parseInt(i),o=parseInt(o),r=parseInt(r),a=parseInt(a);var s=null;if(!(l=(s=t?ge(t,"grid-template-areas"):e.getInlineStylePropertyValue("grid-template-areas"))?m(s):l))for(var l=[],d=0;d<this.num_of_rows;d++){for(var u=[],c=0;c<this.num_of_cols;c++)u.push(".");l.push(u)}for(d=0;d<l.length;d++)for(c=0;c<l[d].length;c++)l[d][c]==n&&(l[d][c]=".");var s=l.length,g=0<s?l[0].length:0;if(0==s||0==g)return!1;if(i<1||g<i||r-1<1||g<r-1||o<1||s<o||a-1<1||s<a-1||r-1<i||a-1<o)return!1;for(var p=o;p<=a-1;p++)for(var h=i;h<=r-1;h++)l[p-1][h-1]=n;t=pe(t);g=de(l);return he(e,t,"grid-template-areas",g),me(e,t,"Create grid area"),!0},P.prototype.getNumber=function(e){return parseFloat(e.replace("px",""))},P.prototype.isGrid=function(e){return(e=e||this.s)&&("grid"==e.display||"inline-grid"==e.display)},P.prototype.makeFixedSizeInDOM=function(){function e(e,t){return y(e).map(function(e){return(val=n.getNumber(e.size))<t&&(val=t),(val=e.name?"["+e.name+"] "+val:val)+"px"}).join(" ")}var n=this;pgSaveOriginalStyle(this.$el),this.$el.css({"grid-template-columns":e(this.s.gridTemplateColumns,0),"grid-template-rows":e(this.s.gridTemplateRows,40)})},P.prototype.restoreOriginalSizeInDOM=function(){pgRestoreOriginalStyle(this.$el)},P.prototype.getCellRect=function(e,t){var n={left:this.getXForColStart(e),right:this.getXForColEnd(e),top:this.getYForRowStart(t),bottom:this.getYForRowEnd(t)};return n.width=n.right-n.left,n.height=n.bottom-n.top,n.name=t+1+` / ${e+1} / ${t+2} / `+(e+2),n},P.prototype.getAvailableAreas=function(){var e=[],t={},n=m(this.s.gridTemplateAreas);if(n)for(var i=0;i<n.length;i++)for(var o=0;o<n[i].length;o++)""==n[i][o]||"."==n[i][o]||t[n[i][o]]||(t[n[i][o]]=!0,e.push(n[i][o]));return e},P.prototype.getAreaPosition=function(e){var t=m(this.s.gridTemplateAreas);if(t){for(var n,i={"grid-column-start":null,"grid-column-end":null,"grid-row-start":null,"grid-row-end":null},o=0;o<t.length;o++)for(n=0;n<t[o].length;n++)t[o][n]==e&&(null===i["grid-row-start"]&&(i["grid-row-start"]=o+1),null===i["grid-column-start"]&&(i["grid-column-start"]=n+1),i["grid-column-end"]=n+2,i["grid-row-end"]=o+2);return i}return null},P.prototype.getColForX=function(e,t,n){return this.getTrackForX(e,t,n)},P.prototype.getTrackForX=function(e,t,n){return this.getTrackForValue("col",e,t,n)},P.prototype.getXForColStart=function(e){for(var t=this.getNumber(this.s.paddingLeft),n=0;n<this.num_of_cols;n++){if(n==e)return t;t=(t+=this.cols[n].value)+this.gap_col}return t},P.prototype.getXForColEnd=function(e){for(var t=this.getNumber(this.s.paddingLeft),n=0;n<this.num_of_cols;n++){if(t+=this.cols[n].value,n==e)return t;t+=this.gap_col}return t},P.prototype.getRowForY=function(e,t,n){return this.getTrackForY(e,t,n)},P.prototype.getRowForYOld=function(e,t,n){null==t&&(t=this.num_of_rows);for(var i=this.getNumber(this.s.paddingTop),o=n?-1:1,r=0;r<this.num_of_rows;r++){if(i<=e&&i+this.rows[r].value+o>=e)return r;if(i+this.rows[r].value<=e&&e<i+this.rows[r].value+this.gap_row)return r;i+=this.gap_row+this.rows[r].value}return t},P.prototype.getColForXOld=function(e,t,n){null==t&&(t=this.num_of_cols);for(var i=this.getNumber(this.s.paddingLeft),o=n?-1:1,r=0;r<this.num_of_cols;r++){if(i<=e&&i+this.cols[r].value+o>=e)return r;if(i+this.cols[r].value<=e&&e<i+this.cols[r].value+this.gap_col)return r;i+=this.gap_col+this.cols[r].value}return t},P.prototype.getTrackForValue=function(e,t,n,i){var o,r,a,s="row"===e?(o=this.num_of_rows,r=this.rows,a=this.gap_row,this.getNumber(this.s.paddingTop)+this.getNumber(this.s.borderTopWidth)):(o=this.num_of_cols,r=this.cols,a=this.gap_col,this.getNumber(this.s.paddingLeft)+this.getNumber(this.s.borderLeftWidth));null==n&&(n=o);for(var l,d=null,u=0;u<o+1;u++){l=void 0,l=s,l=i?l-t:t-l,l=Math.abs(l)<1?0:l;if(null!==d&&0<=d&&(d<l||l<0))return u-1;d=l,u<r.length&&(s+=a+r[u].value)}return n},P.prototype.getTrackForY=function(e,t,n){return this.getTrackForValue("row",e,t,n)},P.prototype.getYForRowStart=function(e){for(var t=this.getNumber(this.s.paddingTop),n=0;n<this.num_of_rows;n++){if(n==e)return t;t=(t+=this.rows[n].value)+this.gap_row}return t},P.prototype.getYForRowEnd=function(e){for(var t=this.getNumber(this.s.paddingTop),n=0;n<this.num_of_rows;n++){if(t+=this.rows[n].value,n==e)return t;t+=this.gap_row}return t},P.prototype.placeAllAutoCellsInDOM=function(){var o=this;this.$el.children().each(function(e,t){var n=$(t),i=new d(n,o);i.isCell()&&i.isAutoPlaced()&&(pgSaveOriginalStyle(n),i=i.autoToFixedPlace(),n.css(i))})},P.prototype.restorePlacedCellsInDOM=function(){this.$el.children().each(function(e,t){var n=$(t);pgRestoreOriginalStyle(n)})},window.PgCSSGridInfo=P,function(e,t){var n=e.get(0);this.s=null,1==(this.el=n).nodeType&&(this.s=window.getComputedStyle(n)),this.grid_info=t,this.update()}),u=(d.prototype.update=function(){this.grid_info&&(this.rect=this.el.getBoundingClientRect(),this.x=this.rect.left-this.grid_info.rect.left,this.end_x=this.x+this.rect.width,this.y=this.rect.top-this.grid_info.rect.top,this.end_y=this.y+this.rect.height)},d.prototype.getGridCSSValue=function(e){return this.s["grid"+e]},d.prototype.isCell=function(){return this.s&&["absolute","fixed"].indexOf(this.s.position)<0&&"none"!=this.s.display},d.prototype.isAutoPlaced=function(){return"auto / auto / auto / auto"==this.s.gridArea&&("auto"==this.s.gridColumnStart||"auto"==this.s.gridColumnEnd||"auto"==this.s.gridRowStart||"auto"==this.s.gridRowEnd)},d.prototype.getAreaName=function(){var e;return!this.s.gridColumnStart.match(/^[^0-9\-\_][a-zA-Z\_\-0-9]*$/)||this.s.gridColumnStart!=this.s.gridColumnEnd||this.s.gridColumnStart!=this.s.gridRowStart||this.s.gridColumnStart!=this.s.gridRowEnd||"auto"==this.s.gridColumnStart||(e=function(e,t){for(var n=0;n<t.length;n++)if(t[n].names)for(var i=0;i<t[n].names.length;i++)if(t[n].names[i].name_parsed==e&&null!==t[n].names[i].start)return!0;return!1})(this.s.gridColumnStart,this.grid_info.cols)&&e(this.s.gridColumnStart,this.grid_info.rows)?null:this.s.gridColumnStart},d.prototype.autoToFixedPlace=function(){var e=u(this.s.gridColumnStart)?this.s.gridColumnStart:this.grid_info.getColForX(this.x)+1,t=u(this.s.gridColumnEnd)?this.s.gridColumnEnd:this.grid_info.getColForX(this.end_x,null,!0)+1,n=u(this.s.gridRowStart)?this.s.gridRowStart:this.grid_info.getRowForY(this.y)+1,i=u(this.s.gridRowEnd)?this.s.gridRowEnd:this.grid_info.getRowForY(this.end_y,null,!0)+1;return{"grid-column-start":e.toString(),"grid-column-end":t.toString(),"grid-row-start":n.toString(),"grid-row-end":i.toString()}},function(e){return"number"==typeof e||"string"==typeof e&&e.match(/^[0-9]+$/)}),c=(d.prototype.getCellColRowPosition=function(e){var t,n=this.getAreaName();if(n&&(t=this.grid_info.getAreaPosition(n)))return t;return e||this.isAutoPlaced()?this.autoToFixedPlace():(t={},(i(this.s.gridColumnStart)||u(this.s.gridColumnStart))&&(t["grid-column-start"]=this.s.gridColumnStart),"grid-column-start"in t||(t["grid-column-start"]=this.grid_info.getColForX(this.x)+1),(i(this.s.gridColumnEnd)||u(this.s.gridColumnEnd))&&(t["grid-column-end"]=this.s.gridColumnEnd),"grid-column-end"in t||(t["grid-column-end"]=this.grid_info.getColForX(this.end_x,null,!0)+1),(i(this.s.gridRowStart)||u(this.s.gridRowStart))&&(t["grid-row-start"]=this.s.gridRowStart),"grid-row-start"in t||(t["grid-row-start"]=this.grid_info.getRowForY(this.y)+1),(i(this.s.gridRowEnd)||u(this.s.gridRowEnd))&&(t["grid-row-end"]=this.s.gridRowEnd),"grid-row-end"in t||(t["grid-row-end"]=this.grid_info.getRowForY(this.end_y,null,!0)+1),t)},d.prototype.getColName=function(e,t){var n;return void 0===t&&(t=!1),!i(e)&&0<=(n=parseInt(e)-1)&&n<this.grid_info.cols.length&&this.grid_info.cols[n].name&&this.grid_info.cols[n].getName(t)||e},d.prototype.getRowName=function(e,t){var n;return void 0===t&&(t=!1),!i(e)&&0<=(n=parseInt(e)-1)&&n<this.grid_info.rows.length&&this.grid_info.rows[n].name&&this.grid_info.rows[n].getName(t)||e},d.prototype.getGridAreaShorthand=function(e){var t=this.getRowName(e["grid-row-start"],!0),n=this.getColName(e["grid-column-start"],!0),i=this.getRowName(e["grid-row-end"]),o=this.getColName(e["grid-column-end"]);return t&&t===n&&n===i&&i===o?t:t+` / ${n} / ${i} / `+o},window.PgCSSGridCellInfo=d,function(){var y=null,S=null,t=(this.show=function(e){function t(e,t,n){return`<pgdiv class="pinegrow-ui-helper pinegrow-ui-helper-${e}" style="${t||""}" ${n||""}>`}for(var n=new P(S=e),i=n.cols,o=n.rows,r=n.gap_col,a=n.gap_row,s=n.getNumber(n.s.paddingLeft),l=n.getNumber(n.s.paddingTop),d=t("css-grid"),u=0,c=0,g=0,p=0,h=0;h<o.length&&!o[h].last;h++)c+=a+o[h].value,p+=o[h].value;for(var m=0;m<i.length&&!i[m].last;m++)u+=r+i[m].value,g+=i[m].value;var f=n.rect.width-s-n.getNumber(n.s.paddingRight),w=n.rect.height-l-n.getNumber(n.s.paddingBottom),_=n.getNumber(n.s.paddingLeft);switch(n.s.justifyContent){case"center":_=Math.max(0,_+(f-u)/2);break;case"end":case"right":case"flex-end":_=Math.max(0,_+(f-u));break;case"space-between":u<f&&1<n.num_of_cols&&(r=(f-g)/(n.num_of_cols-1));break;case"space-around":u<f&&0<n.num_of_cols&&(_+=(r=(f-g)/n.num_of_cols)/2);break;case"space-evenly":u<f&&0<n.num_of_cols&&(_+=r=(f-g)/(n.num_of_cols+1))}var v=l;switch(n.s.alignContent){case"center":v=Math.max(0,v+(w-c)/2);break;case"end":case"flex-end":v=Math.max(0,v+(w-c));break;case"space-between":c<w&&1<n.num_of_rows&&(a=(w-p)/(n.num_of_rows-1));break;case"space-around":c<w&&0<n.num_of_rows&&(v+=(a=(w-p)/n.num_of_rows)/2);break;case"space-evenly":c<w&&0<n.num_of_rows&&(v+=a=(w-p)/(n.num_of_rows+1))}for(l=v,h=0;h<o.length&&!o[h].last;h++){for(s=_,m=0;m<i.length&&!i[m].last;m++)d+=t("css-grid-cell",`top:${l}px;left:${s}px;width:${i[m].value}px;height:${o[h].value}px;`,`data-col-row="${m}-${h}"`)+"</pgdiv>",s+=r+i[m].value;l+=a+o[h].value}d+="</pgdiv>",y=$(d),"static"==n.position&&e.addClass("pinegrow-ui-helper-relative"),e.append(y)},this.update=function(){y&&y.remove(),this.show(S)},!1);this.setHighlight=function(e){t!=e&&(e?y.addClass("pinegrow-ui-helper-css-grid-hl"):y.removeClass("pinegrow-ui-helper-css-grid-hl"),t=e)},this.destroy=function(){y&&y.remove()}}),R=(window.PgCSSGridOverlayControl=c,function(e,t,n,i,o){PgElementPageViewMenuPoint.call(this,e,t);var r=this;this.mode=x.mode,this.placement=e,this.type=n,this.menu=t,this.tooltip="",this.active_css_rule=null,this.$grid=t.$el.parent(),this.info=i||new P(this.$grid),this.cell_info=o||new d(t.$el,this.info),this.onPageViewsUpdated=function(e,t){r.info.update_id&&r.info.update_id==t||(r.info.update(),r.info.update_id=t),r.cell_info.update_id&&r.cell_info.update_id==t||(r.cell_info.update(),r.cell_info.update_id=t)},le.addEventHandler("on_page_views_updated",this.onPageViewsUpdated),this.update()});extendObject(R,PgElementPageViewMenuPoint),R.prototype.setIsNotSet=function(e){PgElementPageViewMenuPoint.prototype.setIsNotSet.call(this,e),this.tooltip=e?"Positioned automatically or with a named area. Move to position with columns &amp; rows.":null},R.prototype.update=function(){switch(this.type){case"column-start":"auto"==this.cell_info.getGridCSSValue("ColumnStart")?(this.setText("A"),this.setIsNotSet(!0)):this.setText(this.cell_info.colRowPosition["grid-"+this.type]);break;case"column-end":"auto"==this.cell_info.getGridCSSValue("ColumnEnd")?(this.setText("A"),this.setIsNotSet(!0)):this.setText(this.cell_info.colRowPosition["grid-"+this.type]);break;case"row-start":"auto"==this.cell_info.getGridCSSValue("RowStart")?(this.setText("A"),this.setIsNotSet(!0)):this.setText(this.cell_info.colRowPosition["grid-"+this.type]);break;case"row-end":"auto"==this.cell_info.getGridCSSValue("RowEnd")?(this.setText("A"),this.setIsNotSet(!0)):this.setText(this.cell_info.colRowPosition["grid-"+this.type])}},R.prototype.add=function(e,t){PgElementPageViewMenuPoint.prototype.add.call(this,e,t),this.update()},R.prototype.onReposition=function(){this.in_drag||this.update()},R.prototype.onDragStart=function(e,t){this.original_z=this.menu.$el.css("z-index"),this.info.makeFixedSizeInDOM(),this.info.update(),this.cell_info.update(),pgSaveOriginalStyle(this.menu.$el),this.info.placeAllAutoCellsInDOM(),this.menu.$el.addClass("pinegrow-grid-cell-during-resize"),this.info.$el.addClass("pinegrow-grid-during-resize"),this.mode,this.current_value=null,this.onDragStarted&&this.onDragStarted.call(this)},R.prototype.onDrag=function(e,t){var n=e/this.menu.pageView.zoom,i=t/this.menu.pageView.zoom;switch(0,le.keyState.shift&&pgIsDev()&&(le.keyState.shift=!1),this.type){case"column-start":var o=this.info.getColForX(this.cell_info.x+n,0);this.cell_info.colRowPosition["grid-"+this.type]=Math.min(o+1,this.info.num_of_cols);break;case"column-end":this.cell_info.colRowPosition["grid-"+this.type]=Math.min(this.info.getColForX(this.cell_info.end_x+n,null,!0)+1,this.info.num_of_cols+1);break;case"row-start":o=this.info.getRowForY(this.cell_info.y+i,0)+1;this.cell_info.colRowPosition["grid-"+this.type]=Math.min(o,this.info.num_of_rows);break;case"row-end":this.cell_info.colRowPosition["grid-"+this.type]=Math.min(this.info.getRowForY(this.cell_info.end_y+i,null,!0)+1,this.info.num_of_rows+1)}var r,a,s,l=this.current_value=this.cell_info.getGridAreaShorthand(this.cell_info.colRowPosition);return"css"===this.mode?(this.active_css_rule=pe(this.active_css_rule),console.log("GRID DRAG UPDATE"),E(this.menu.pgel,this.active_css_rule,l)):(r=this.menu.pgel,a="grid-area",s=l,l=pgDmStore.getSkillByKey("grid.item"),pgDmStore.setSkillParam(r,l,a,s)),this.update(),this.setIsNotSet(!1),this.area_name_point&&(this.area_name_point.destroy(),this.area_name_point=null),this.menu.reposition(),{x:e,y:t}},R.prototype.onClick=function(){},R.prototype.onDragStop=function(e,t){le.removeEventHandler("on_page_views_updated",this.onPageViewsUpdated),("css"==this.mode?pgForgetOriginalStyle:pgRestoreOriginalStyle)(this.menu.$el),this.menu.$el.removeClass("pinegrow-grid-cell-during-resize"),this.info.$el.removeClass("pinegrow-grid-during-resize"),this.setLabel(),this.info.restoreOriginalSizeInDOM(),this.info.restorePlacedCellsInDOM(),"css"==this.mode?this.current_value&&(this.active_css_rule=pe(this.active_css_rule),E(this.menu.pgel,this.active_css_rule,this.current_value),me(this.menu.pgel,this.active_css_rule,"Set position in grid")):le.changeManager.didChange(this.menu.pgel,"Change position in grid"),le.selectedElements.reselect()}}),fe=function(){var a=$("<div/>");this.test=function(e,t){if("string"!=typeof t||""===t)return!0;var n=!0;try{if(t.match(/[\$\@]/)||(a.css(e,t),n=""!==a.css(e),a.css(e,"")),n){for(var i=0,o=0;o<t.length;o++){var r=t.charAt(o);"("===r?i++:")"===r&&i--}0!==i&&(n=!1)}}catch(e){}return n}})});