var PgBrowserSync=function(){function n(e){var r;s&&(r=pinegrow.getCurrentProject())&&(e=r.getRelativeUrl(e),t.indexOf(e)<0)&&(t.push(e),i.run("reload",async function(){if(t.length){var r=o+"/__browser_sync__?method=reload";t.forEach(function(e){r+=`&args=`+e}),t=[];try{await pgFetchRemoteContent(r)}catch(e){console.log(`BrowserSync is not running on `+o);var n=(new Date).getTime();6e4<n-a&&(pinegrow.showQuickError(`BrowserSync is not running on ${o}. Start it or switch off the sync in the top toolbar with <i class="icon icon-27"></i>.`),a=n)}}},250))}var o=pinegrow.getSetting("browsersync-url","http://localhost:3000"),t=[],i=new PgDelayedTasks,s="1"===pinegrow.getSetting("browsersync-enabled","0"),a=0;pinegrow.addEventHandler("on_page_changes_done",function(e){n(e.url)}),pinegrow.addEventHandler("on_css_stylesheet_changed",function(e,r){r.url&&n(r.url)}),$(".commands-toolbar").get(0).addEventListener("click",function(e){var n;(e.target.matches(".icon-27")||e.target.querySelector(".icon-27"))&&(e.preventDefault(),e.stopPropagation(),(n=pinegrow.getSelectedPage())?new CrsaContextMenu([{label:"Open the page in browser",action:function(){var e,r;s?(r=pinegrow.getCurrentProject())?r.isUrlInProject(n.url)?(r=r.getRelativeUrl(n.url),e=require("nw.gui"),r=o+"/"+r,e.Shell.openExternal(r)):(pinegrow.showQuickError("The page is not part of the current project. Opening in the browser instead..."),n.openInBrowser()):pinegrow.showQuickError("This feature requires projects. Open the page as Project first."):n.openInBrowser()}},{type:"divider"},{type:"header",label:"BrowserSync"},{label:"Use BrowserSync",check:s,action:function(){s=!s,pinegrow.setSetting("browsersync-enabled",s?"1":"0"),pinegrow.showMode("BrowserSync",s)}},{label:"How to start BrowserSync",action:function(){pinegrow.showAlert(`<p>BrowserSync must be running for this feature to work.</p><p>To start BrowserSync:</p><ul>
<li>Open the terminal / command prompt</li>
<li>Run <code>browser-sync start --proxy "${pinegrow.getApiUrl()}"</code></li>
</ul>
<p><a href="https://pinegrow.com/docs/master-pinegrow/using-external-code-editors/live-preview-on-any-device-or-browser-with-browsersync/" class="external">Learn more about using BrowserSync in Pinegrow.</a></p>`,"How to start BrowserSync")}},{label:"Settings...",action:function(){var e={url:{name:"BrowserSync url",type:"text",value:o}};pinegrow.showQuickDialog(`BrowserSync Settings`,"Settings",`<p>BrowserSync is an external and free tool that let's you preview pages on multiple browsers / devices while you edit them in Pinegrow. All changes will be shown in the browser, without having to save them first.</p><p><a href="https://pinegrow.com/docs/master-pinegrow/using-external-code-editors/live-preview-on-any-device-or-browser-with-browsersync/" class="external">Learn more about using BrowserSync in Pinegrow.</a></p>`,e,"Cancel","Save",null,function(e){o=e.url||"http://localhost:3000",pinegrow.setSetting("browsersync-url",o)})}}],$(e.target)).showForElement($(e.target)):pinegrow.showQuickMessage("Nothing to preview in browser. Open a page first."))},!0)};